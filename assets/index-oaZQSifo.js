(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const _ of o.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&r(_)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var Re,D,mt,ve,Je,gt,yt,bt,He,Ue,xe,Ee={},St=[],Bt=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,$e=Array.isArray;function fe(e,t){for(var n in t)e[n]=t[n];return e}function ze(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function Rt(e,t,n){var r,i,o,_={};for(o in t)o=="key"?r=t[o]:o=="ref"?i=t[o]:_[o]=t[o];if(arguments.length>2&&(_.children=arguments.length>3?Re.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(o in e.defaultProps)_[o]===void 0&&(_[o]=e.defaultProps[o]);return Ie(e,_,r,i,null)}function Ie(e,t,n,r,i){var o={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++mt,__i:-1,__u:0};return i==null&&D.vnode!=null&&D.vnode(o),o}function me(e){return e.children}function we(e,t){this.props=e,this.context=t}function ge(e,t){if(t==null)return e.__?ge(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?ge(e):null}function kt(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return kt(e)}}function et(e){(!e.__d&&(e.__d=!0)&&ve.push(e)&&!Oe.__r++||Je!=D.debounceRendering)&&((Je=D.debounceRendering)||gt)(Oe)}function Oe(){for(var e,t,n,r,i,o,_,c=1;ve.length;)ve.length>c&&ve.sort(yt),e=ve.shift(),c=ve.length,e.__d&&(n=void 0,i=(r=(t=e).__v).__e,o=[],_=[],t.__P&&((n=fe({},r)).__v=r.__v+1,D.vnode&&D.vnode(n),je(t.__P,n,r,t.__n,t.__P.namespaceURI,32&r.__u?[i]:null,o,i??ge(r),!!(32&r.__u),_),n.__v=r.__v,n.__.__k[n.__i]=n,Pt(o,n,_),n.__e!=i&&kt(n)));Oe.__r=0}function At(e,t,n,r,i,o,_,c,s,a,v){var l,S,d,A,w,$,N,O=r&&r.__k||St,U=t.length;for(s=$t(n,t,O,s,U),l=0;l<U;l++)(d=n.__k[l])!=null&&(S=d.__i==-1?Ee:O[d.__i]||Ee,d.__i=l,$=je(e,d,S,i,o,_,c,s,a,v),A=d.__e,d.ref&&S.ref!=d.ref&&(S.ref&&Ge(S.ref,null,d),v.push(d.ref,d.__c||A,d)),w==null&&A!=null&&(w=A),(N=!!(4&d.__u))||S.__k===d.__k?s=Et(d,s,e,N):typeof d.type=="function"&&$!==void 0?s=$:A&&(s=A.nextSibling),d.__u&=-7);return n.__e=w,s}function $t(e,t,n,r,i){var o,_,c,s,a,v=n.length,l=v,S=0;for(e.__k=new Array(i),o=0;o<i;o++)(_=t[o])!=null&&typeof _!="boolean"&&typeof _!="function"?(s=o+S,(_=e.__k[o]=typeof _=="string"||typeof _=="number"||typeof _=="bigint"||_.constructor==String?Ie(null,_,null,null,null):$e(_)?Ie(me,{children:_},null,null,null):_.constructor==null&&_.__b>0?Ie(_.type,_.props,_.key,_.ref?_.ref:null,_.__v):_).__=e,_.__b=e.__b+1,c=null,(a=_.__i=Lt(_,n,s,l))!=-1&&(l--,(c=n[a])&&(c.__u|=2)),c==null||c.__v==null?(a==-1&&(i>v?S--:i<v&&S++),typeof _.type!="function"&&(_.__u|=4)):a!=s&&(a==s-1?S--:a==s+1?S++:(a>s?S--:S++,_.__u|=4))):e.__k[o]=null;if(l)for(o=0;o<v;o++)(c=n[o])!=null&&(2&c.__u)==0&&(c.__e==r&&(r=ge(c)),Ct(c,c));return r}function Et(e,t,n,r){var i,o;if(typeof e.type=="function"){for(i=e.__k,o=0;i&&o<i.length;o++)i[o]&&(i[o].__=e,t=Et(i[o],t,n,r));return t}e.__e!=t&&(r&&(t&&e.type&&!t.parentNode&&(t=ge(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function Lt(e,t,n,r){var i,o,_,c=e.key,s=e.type,a=t[n],v=a!=null&&(2&a.__u)==0;if(a===null&&e.key==null||v&&c==a.key&&s==a.type)return n;if(r>(v?1:0)){for(i=n-1,o=n+1;i>=0||o<t.length;)if((a=t[_=i>=0?i--:o++])!=null&&(2&a.__u)==0&&c==a.key&&s==a.type)return _}return-1}function tt(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||Bt.test(t)?n:n+"px"}function Ce(e,t,n,r,i){var o,_;e:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof r=="string"&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||tt(e.style,t,"");if(n)for(t in n)r&&n[t]==r[t]||tt(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")o=t!=(t=t.replace(bt,"$1")),_=t.toLowerCase(),t=_ in e||t=="onFocusOut"||t=="onFocusIn"?_.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=n,n?r?n.u=r.u:(n.u=He,e.addEventListener(t,o?xe:Ue,o)):e.removeEventListener(t,o?xe:Ue,o);else{if(i=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function nt(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=He++;else if(t.t<n.u)return;return n(D.event?D.event(t):t)}}}function je(e,t,n,r,i,o,_,c,s,a){var v,l,S,d,A,w,$,N,O,U,Q,re,X,J,te,k,M,R=t.type;if(t.constructor!=null)return null;128&n.__u&&(s=!!(32&n.__u),o=[c=t.__e=n.__e]),(v=D.__b)&&v(t);e:if(typeof R=="function")try{if(N=t.props,O="prototype"in R&&R.prototype.render,U=(v=R.contextType)&&r[v.__c],Q=v?U?U.props.value:v.__:r,n.__c?$=(l=t.__c=n.__c).__=l.__E:(O?t.__c=l=new R(N,Q):(t.__c=l=new we(N,Q),l.constructor=R,l.render=Ft),U&&U.sub(l),l.props=N,l.state||(l.state={}),l.context=Q,l.__n=r,S=l.__d=!0,l.__h=[],l._sb=[]),O&&l.__s==null&&(l.__s=l.state),O&&R.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=fe({},l.__s)),fe(l.__s,R.getDerivedStateFromProps(N,l.__s))),d=l.props,A=l.state,l.__v=t,S)O&&R.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),O&&l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(O&&R.getDerivedStateFromProps==null&&N!==d&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(N,Q),!l.__e&&l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(N,l.__s,Q)===!1||t.__v==n.__v){for(t.__v!=n.__v&&(l.props=N,l.state=l.__s,l.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(u){u&&(u.__=t)}),re=0;re<l._sb.length;re++)l.__h.push(l._sb[re]);l._sb=[],l.__h.length&&_.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(N,l.__s,Q),O&&l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(d,A,w)})}if(l.context=Q,l.props=N,l.__P=e,l.__e=!1,X=D.__r,J=0,O){for(l.state=l.__s,l.__d=!1,X&&X(t),v=l.render(l.props,l.state,l.context),te=0;te<l._sb.length;te++)l.__h.push(l._sb[te]);l._sb=[]}else do l.__d=!1,X&&X(t),v=l.render(l.props,l.state,l.context),l.state=l.__s;while(l.__d&&++J<25);l.state=l.__s,l.getChildContext!=null&&(r=fe(fe({},r),l.getChildContext())),O&&!S&&l.getSnapshotBeforeUpdate!=null&&(w=l.getSnapshotBeforeUpdate(d,A)),k=v,v!=null&&v.type===me&&v.key==null&&(k=Tt(v.props.children)),c=At(e,$e(k)?k:[k],t,n,r,i,o,_,c,s,a),l.base=t.__e,t.__u&=-161,l.__h.length&&_.push(l),$&&(l.__E=l.__=null)}catch(u){if(t.__v=null,s||o!=null)if(u.then){for(t.__u|=s?160:128;c&&c.nodeType==8&&c.nextSibling;)c=c.nextSibling;o[o.indexOf(c)]=null,t.__e=c}else{for(M=o.length;M--;)ze(o[M]);De(t)}else t.__e=n.__e,t.__k=n.__k,u.then||De(t);D.__e(u,t,n)}else o==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):c=t.__e=Kt(n.__e,t,n,r,i,o,_,s,a);return(v=D.diffed)&&v(t),128&t.__u?void 0:c}function De(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(De)}function Pt(e,t,n){for(var r=0;r<n.length;r++)Ge(n[r],n[++r],n[++r]);D.__c&&D.__c(t,e),e.some(function(i){try{e=i.__h,i.__h=[],e.some(function(o){o.call(i)})}catch(o){D.__e(o,i.__v)}})}function Tt(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:$e(e)?e.map(Tt):fe({},e)}function Kt(e,t,n,r,i,o,_,c,s){var a,v,l,S,d,A,w,$=n.props,N=t.props,O=t.type;if(O=="svg"?i="http://www.w3.org/2000/svg":O=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),o!=null){for(a=0;a<o.length;a++)if((d=o[a])&&"setAttribute"in d==!!O&&(O?d.localName==O:d.nodeType==3)){e=d,o[a]=null;break}}if(e==null){if(O==null)return document.createTextNode(N);e=document.createElementNS(i,O,N.is&&N),c&&(D.__m&&D.__m(t,o),c=!1),o=null}if(O==null)$===N||c&&e.data==N||(e.data=N);else{if(o=o&&Re.call(e.childNodes),$=n.props||Ee,!c&&o!=null)for($={},a=0;a<e.attributes.length;a++)$[(d=e.attributes[a]).name]=d.value;for(a in $)if(d=$[a],a!="children"){if(a=="dangerouslySetInnerHTML")l=d;else if(!(a in N)){if(a=="value"&&"defaultValue"in N||a=="checked"&&"defaultChecked"in N)continue;Ce(e,a,null,d,i)}}for(a in N)d=N[a],a=="children"?S=d:a=="dangerouslySetInnerHTML"?v=d:a=="value"?A=d:a=="checked"?w=d:c&&typeof d!="function"||$[a]===d||Ce(e,a,d,$[a],i);if(v)c||l&&(v.__html==l.__html||v.__html==e.innerHTML)||(e.innerHTML=v.__html),t.__k=[];else if(l&&(e.innerHTML=""),At(t.type=="template"?e.content:e,$e(S)?S:[S],t,n,r,O=="foreignObject"?"http://www.w3.org/1999/xhtml":i,o,_,o?o[0]:n.__k&&ge(n,0),c,s),o!=null)for(a=o.length;a--;)ze(o[a]);c||(a="value",O=="progress"&&A==null?e.removeAttribute("value"):A!=null&&(A!==e[a]||O=="progress"&&!A||O=="option"&&A!=$[a])&&Ce(e,a,A,$[a],i),a="checked",w!=null&&w!=e[a]&&Ce(e,a,w,$[a],i))}return e}function Ge(e,t,n){try{if(typeof e=="function"){var r=typeof e.__u=="function";r&&e.__u(),r&&t==null||(e.__u=e(t))}else e.current=t}catch(i){D.__e(i,n)}}function Ct(e,t,n){var r,i;if(D.unmount&&D.unmount(e),(r=e.ref)&&(r.current&&r.current!=e.__e||Ge(r,null,t)),(r=e.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(o){D.__e(o,t)}r.base=r.__P=null}if(r=e.__k)for(i=0;i<r.length;i++)r[i]&&Ct(r[i],t,n||typeof e.type!="function");n||ze(e.__e),e.__c=e.__=e.__e=void 0}function Ft(e,t,n){return this.constructor(e,n)}function Wt(e,t,n){var r,i,o,_;t==document&&(t=document.documentElement),D.__&&D.__(e,t),i=(r=!1)?null:t.__k,o=[],_=[],je(t,e=t.__k=Rt(me,null,[e]),i||Ee,Ee,t.namespaceURI,i?null:t.firstChild?Re.call(t.childNodes):null,o,i?i.__e:t.firstChild,r,_),Pt(o,e,_)}Re=St.slice,D={__e:function(e,t,n,r){for(var i,o,_;t=t.__;)if((i=t.__c)&&!i.__)try{if((o=i.constructor)&&o.getDerivedStateFromError!=null&&(i.setState(o.getDerivedStateFromError(e)),_=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(e,r||{}),_=i.__d),_)return i.__E=i}catch(c){e=c}throw e}},mt=0,we.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=fe({},this.state),typeof e=="function"&&(e=e(fe({},n),this.props)),e&&fe(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),et(this))},we.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),et(this))},we.prototype.render=me,ve=[],gt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,yt=function(e,t){return e.__v.__b-t.__v.__b},Oe.__r=0,bt=/(PointerCapture)$|Capture$/i,He=0,Ue=nt(!1),xe=nt(!0);var Ut=0;function b(e,t,n,r,i,o){t||(t={});var _,c,s=t;if("ref"in s)for(c in s={},t)c=="ref"?_=t[c]:s[c]=t[c];var a={type:e,props:s,key:n,ref:_,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Ut,__i:-1,__u:0,__source:i,__self:o};if(typeof e=="function"&&(_=e.defaultProps))for(c in _)s[c]===void 0&&(s[c]=_[c]);return D.vnode&&D.vnode(a),a}var Pe,z,Ke,rt,qe=0,Nt=[],G=D,it=G.__b,st=G.__r,ot=G.diffed,at=G.__c,lt=G.unmount,ct=G.__;function Ve(e,t){G.__h&&G.__h(z,e,qe||t),qe=0;var n=z.__H||(z.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function Z(e){return qe=1,xt(wt,e)}function xt(e,t,n){var r=Ve(Pe++,2);if(r.t=e,!r.__c&&(r.__=[wt(void 0,t),function(c){var s=r.__N?r.__N[0]:r.__[0],a=r.t(s,c);s!==a&&(r.__N=[a,r.__[1]],r.__c.setState({}))}],r.__c=z,!z.__f)){var i=function(c,s,a){if(!r.__c.__H)return!0;var v=r.__c.__H.__.filter(function(S){return!!S.__c});if(v.every(function(S){return!S.__N}))return!o||o.call(this,c,s,a);var l=r.__c.props!==c;return v.forEach(function(S){if(S.__N){var d=S.__[0];S.__=S.__N,S.__N=void 0,d!==S.__[0]&&(l=!0)}}),o&&o.call(this,c,s,a)||l};z.__f=!0;var o=z.shouldComponentUpdate,_=z.componentWillUpdate;z.componentWillUpdate=function(c,s,a){if(this.__e){var v=o;o=void 0,i(c,s,a),o=v}_&&_.call(this,c,s,a)},z.shouldComponentUpdate=i}return r.__N||r.__}function Be(e,t){var n=Ve(Pe++,3);!G.__s&&It(n.__H,t)&&(n.__=e,n.u=t,z.__H.__h.push(n))}function Dt(e,t){var n=Ve(Pe++,7);return It(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function qt(){for(var e;e=Nt.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(Me),e.__H.__h.forEach(Qe),e.__H.__h=[]}catch(t){e.__H.__h=[],G.__e(t,e.__v)}}G.__b=function(e){z=null,it&&it(e)},G.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),ct&&ct(e,t)},G.__r=function(e){st&&st(e),Pe=0;var t=(z=e.__c).__H;t&&(Ke===z?(t.__h=[],z.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(Me),t.__h.forEach(Qe),t.__h=[],Pe=0)),Ke=z},G.diffed=function(e){ot&&ot(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(Nt.push(t)!==1&&rt===G.requestAnimationFrame||((rt=G.requestAnimationFrame)||Qt)(qt)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Ke=z=null},G.__c=function(e,t){t.some(function(n){try{n.__h.forEach(Me),n.__h=n.__h.filter(function(r){return!r.__||Qe(r)})}catch(r){t.some(function(i){i.__h&&(i.__h=[])}),t=[],G.__e(r,n.__v)}}),at&&at(e,t)},G.unmount=function(e){lt&&lt(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{Me(r)}catch(i){t=i}}),n.__H=void 0,t&&G.__e(t,n.__v))};var ut=typeof requestAnimationFrame=="function";function Qt(e){var t,n=function(){clearTimeout(r),ut&&cancelAnimationFrame(t),setTimeout(e)},r=setTimeout(n,35);ut&&(t=requestAnimationFrame(n))}function Me(e){var t=z,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),z=t}function Qe(e){var t=z;e.__c=e.__(),z=t}function It(e,t){return!e||e.length!==t.length||t.some(function(n,r){return n!==e[r]})}function wt(e,t){return typeof t=="function"?t(e):t}var Fe={},ce={},I={},We={},ft;function Te(){return ft||(ft=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ROOKS=e.SQUARES=e.RANKS=e.RANK_8=e.RANK_7=e.RANK_6=e.RANK_5=e.RANK_4=e.RANK_3=e.RANK_2=e.RANK_1=e.BITS=e.FLAGS=e.SHIFTS=e.RAYS=e.ATTACKS=e.PIECE_OFFSETS=e.PAWN_OFFSETS=e.POSSIBLE_RESULTS=e.DEFAULT_POSITION=e.SYMBOLS=e.EMPTY=e.KING=e.QUEEN=e.ROOK=e.BISHOP=e.KNIGHT=e.PAWN=e.BLACK=e.WHITE=void 0,e.WHITE="w",e.BLACK="b",e.PAWN="p",e.KNIGHT="n",e.BISHOP="b",e.ROOK="r",e.QUEEN="q",e.KING="k",e.EMPTY=-1,e.SYMBOLS="pnbrqkPNBRQK",e.DEFAULT_POSITION="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",e.POSSIBLE_RESULTS=["1-0","0-1","1/2-1/2","*"],e.PAWN_OFFSETS={b:[16,32,17,15],w:[-16,-32,-17,-15]},e.PIECE_OFFSETS={p:[],n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},e.ATTACKS=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],e.RAYS=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],e.SHIFTS={p:0,n:1,b:2,r:3,q:4,k:5},e.FLAGS={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},e.BITS={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},e.RANK_1=7,e.RANK_2=6,e.RANK_3=5,e.RANK_4=4,e.RANK_5=3,e.RANK_6=2,e.RANK_7=1,e.RANK_8=0,e.RANKS=[e.RANK_8,e.RANK_7,e.RANK_6,e.RANK_5,e.RANK_4,e.RANK_3,e.RANK_2,e.RANK_1],e.SQUARES={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},e.ROOKS={w:[{square:e.SQUARES.a1,flag:e.BITS.QSIDE_CASTLE},{square:e.SQUARES.h1,flag:e.BITS.KSIDE_CASTLE}],b:[{square:e.SQUARES.a8,flag:e.BITS.QSIDE_CASTLE},{square:e.SQUARES.h8,flag:e.BITS.KSIDE_CASTLE}]}})(We)),We}var ke={},ht;function Ye(){if(ht)return ke;ht=1,Object.defineProperty(ke,"__esModule",{value:!0}),ke.State=void 0;var e=Te(),t=Mt(),n=(function(){function r(i,o,_,c,s,a,v){this.board=i||new Array(128),this.kings=o||{w:e.EMPTY,b:e.EMPTY},this.turn=_||e.WHITE,this.castling=c||{w:0,b:0},this.ep_square=s||e.EMPTY,this.half_moves=a||0,this.move_number=v||1}return r.prototype.clone=function(){return new r(this.board.slice(),{w:this.kings.w,b:this.kings.b},this.turn,{w:this.castling.w,b:this.castling.b},this.ep_square,this.half_moves,this.move_number)},Object.defineProperty(r.prototype,"fen",{get:function(){return t.getFen(this)},enumerable:!1,configurable:!0}),r})();return ke.State=n,ke}var x={},_t;function Ze(){if(_t)return x;_t=1,Object.defineProperty(x,"__esModule",{value:!0}),x.strippedSan=x.validateFen=x.isFlagKey=x.isSquare=x.isPieceSymbol=x.isColor=x.symbol=x.isDigit=x.swapColor=x.algebraic=x.file=x.rank=void 0;var e=Te();function t(d){return d>>4}x.rank=t;function n(d){return d&15}x.file=n;function r(d){var A=n(d),w=t(d);return"abcdefgh".substring(A,A+1)+"87654321".substring(w,w+1)}x.algebraic=r;function i(d){return d===e.WHITE?e.BLACK:e.WHITE}x.swapColor=i;function o(d){return/^[0-9]$/.test(d)}x.isDigit=o;function _(d){var A=d.type,w=d.color;return w===e.WHITE?A.toUpperCase():A.toLowerCase()}x.symbol=_;function c(d){return d==="w"||d==="b"}x.isColor=c;function s(d){return/^[pnbrqk]$/.test(d)}x.isPieceSymbol=s;function a(d){return/^[a-h][1-8]$/.test(d)}x.isSquare=a;function v(d){var A=["NORMAL","CAPTURE","BIG_PAWN","EP_CAPTURE","PROMOTION","KSIDE_CASTLE","QSIDE_CASTLE"];return A.indexOf(d)!==-1}x.isFlagKey=v;function l(d){var A={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"Illegal en-passant square"},w=d.split(/\s+/);if(w.length!==6)return{valid:!1,error_number:1,error:A[1]};if(isNaN(w[5])||parseInt(w[5],10)<=0)return{valid:!1,error_number:2,error:A[2]};if(isNaN(w[4])||parseInt(w[4],10)<0)return{valid:!1,error_number:3,error:A[3]};if(!/^(-|[abcdefgh][36])$/.test(w[3]))return{valid:!1,error_number:4,error:A[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(w[2]))return{valid:!1,error_number:5,error:A[5]};if(!/^(w|b)$/.test(w[1]))return{valid:!1,error_number:6,error:A[6]};var $=w[0].split("/");if($.length!==8)return{valid:!1,error_number:7,error:A[7]};for(var N=0;N<$.length;N++){for(var O=0,U=!1,Q=0;Q<$[N].length;Q++)if(isNaN($[N][Q])){if(!/^[prnbqkPRNBQK]$/.test($[N][Q]))return{valid:!1,error_number:9,error:A[9]};O+=1,U=!1}else{if(U)return{valid:!1,error_number:8,error:A[8]};O+=parseInt($[N][Q],10),U=!0}if(O!==8)return{valid:!1,error_number:10,error:A[10]}}return w[3][1]=="3"&&w[1]=="w"||w[3][1]=="6"&&w[1]=="b"?{valid:!1,error_number:11,error:A[11]}:{valid:!0,error_number:0,error:A[0]}}x.validateFen=l;function S(d){return d.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}return x.strippedSan=S,x}var dt;function Mt(){if(dt)return I;dt=1,Object.defineProperty(I,"__esModule",{value:!0}),I.validateMove=I.getBoard=I.ascii=I.buildMove=I.makeMove=I.insufficientMaterial=I.inStalemate=I.inCheckmate=I.inCheck=I.isKingAttacked=I.isAttacked=I.makePretty=I.sanToMove=I.moveToSan=I.generateMoves=I.removePiece=I.putPiece=I.clonePiece=I.cloneMove=I.getPiece=I.loadPgn=I.getPgn=I.loadFen=I.getFen=I.getDisambiguator=void 0;var e=Te(),t=Ye(),n=Ze();function r(u,f,p){for(var m=d(u,{legal:!p}),y=f.from,P=f.to,E=f.piece,C=0,h=0,g=0,T=0,B=m.length;T<B;T++){var W=m[T].from,L=m[T].to,K=m[T].piece;E===K&&y!==W&&P===L&&(C++,n.rank(y)===n.rank(W)&&h++,n.file(y)===n.file(W)&&g++)}return C>0?h>0&&g>0?n.algebraic(y):g>0?n.algebraic(y).charAt(1):n.algebraic(y).charAt(0):""}I.getDisambiguator=r;function i(u){for(var f=0,p="",m=e.SQUARES.a8;m<=e.SQUARES.h1;m++){var y=u.board[m];if(!y)f++;else{f>0&&(p+=f,f=0);var P=y.color,E=y.type;p+=P===e.WHITE?E.toUpperCase():E.toLowerCase()}m+1&136&&(f>0&&(p+=f),m!==e.SQUARES.h1&&(p+="/"),f=0,m+=8)}var C="";u.castling[e.WHITE]&e.BITS.KSIDE_CASTLE&&(C+="K"),u.castling[e.WHITE]&e.BITS.QSIDE_CASTLE&&(C+="Q"),u.castling[e.BLACK]&e.BITS.KSIDE_CASTLE&&(C+="k"),u.castling[e.BLACK]&e.BITS.QSIDE_CASTLE&&(C+="q"),C=C||"-";var h=u.ep_square===e.EMPTY?"-":n.algebraic(u.ep_square);return[p,u.turn,C,h,u.half_moves,u.move_number].join(" ")}I.getFen=i;function o(u){var f=u.split(/\s+/),p=f[0],m=0;if(!n.validateFen(u).valid)return null;for(var y=new t.State,P=0;P<p.length;P++){var E=p.charAt(P);if(E==="/")m+=8;else if(n.isDigit(E))m+=parseInt(E,10);else{var C=E<"a"?e.WHITE:e.BLACK,h=l(y,{type:E.toLowerCase(),color:C},n.algebraic(m));if(!h)return null;y=h,m++}}return y.turn=f[1]===e.BLACK?e.BLACK:e.WHITE,f[2].indexOf("K")>-1&&(y.castling.w|=e.BITS.KSIDE_CASTLE),f[2].indexOf("Q")>-1&&(y.castling.w|=e.BITS.QSIDE_CASTLE),f[2].indexOf("k")>-1&&(y.castling.b|=e.BITS.KSIDE_CASTLE),f[2].indexOf("q")>-1&&(y.castling.b|=e.BITS.QSIDE_CASTLE),y.ep_square=f[3]==="-"?e.EMPTY:e.SQUARES[f[3]],y.half_moves=parseInt(f[4],10),y.move_number=parseInt(f[5],10),y}I.loadFen=o;function _(u,f,p,m,y){y===void 0&&(y={});var P=y.newline_char,E=P===void 0?`
`:P,C=y.max_width,h=C===void 0?0:C,g=[],T=!1;for(var B in f)g.push("["+B+' "'+f[B]+'"]'+E),T=!0;T&&m.length&&g.push(E);var W=function(j){var V=p[u.fen];if(typeof V<"u"){var Y=j.length>0?" ":"";j=""+j+Y+"{"+V+"}"}return j};m[0]&&(u=m[0].state);var L=[],K="";if(m.length===0&&L.push(W("")),m.forEach(function(j,V){var Y=j.move;K=W(K),V===0&&Y.color===e.BLACK?K=u.move_number+". ...":Y.color===e.WHITE&&(K.length&&L.push(K),K=u.move_number+"."),K=K+" "+A(u,Y),u=J(u,Y)}),K.length&&L.push(W(K)),typeof f.Result<"u"&&L.push(f.Result),h===0)return g.join("")+L.join(" ");for(var F=function(){return g.length>0&&g[g.length-1]===" "?(g.pop(),!0):!1},ee=function(j,V){for(var Y=0,le=V.split(" ");Y<le.length;Y++){var ie=le[Y];if(ie){if(j+ie.length>h){for(;F();)j--;g.push(E),j=0}g.push(ie),j+=ie.length,g.push(" "),j++}}return F()&&j--,j},H=0,B=0;B<L.length;B++){if(H+L[B].length>h&&L[B].includes("{")){H=ee(H,L[B]);continue}H+L[B].length>h&&B!==0?(g[g.length-1]===" "&&g.pop(),g.push(E),H=0):B!==0&&(g.push(" "),H++),g.push(L[B]),H+=L[B].length}return g.join("")}I.getPgn=_;function c(u,f){f===void 0&&(f={});var p=f.newline_char,m=p===void 0?`\r?
`:p,y=f.sloppy,P=y===void 0?!1:y,E=function(q){return q.replace(/\\/g,"\\")},C=function(q,ne){for(var ye=ne.newline_char,be={},_e=q.split(new RegExp(E(ye))),he="",Se="",de=0;de<_e.length;de++)he=_e[de].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),Se=_e[de].replace(/^\[[A-Za-z]+\s"(.*)" *\]$/,"$1"),he.trim().length>0&&(be[he.trim()]=Se);return be},h=new RegExp("^(\\[((?:"+E(m)+")|.)*\\])(?:"+E(m)+"){2}"),g=h.test(u)?h.exec(u)[1]:"",T=o(e.DEFAULT_POSITION),B=C(g,{newline_char:m});if(B.SetUp==="1"&&"FEN"in B){var W=o(B.FEN);if(!W)return null;T=W}for(var L=function(q){return Array.from(q).map(function(ne){return ne.charCodeAt(0)<128?ne.charCodeAt(0).toString(16):encodeURIComponent(ne).replace(/%/g,"").toLowerCase()}).join("")},K=function(q){var ne;return q.length==0?"":decodeURIComponent("%"+((ne=q?.match(/.{1,2}/g))===null||ne===void 0?void 0:ne.join("%")))},F=function(q){return q=q.replace(new RegExp(E(m),"g")," "),"{"+L(q.slice(1,q.length-1))+"}"},ee=function(q){if(q.startsWith("{")&&q.endsWith("}"))return K(q.slice(1,q.length-1))},H=u.replace(g,"").replace(new RegExp("({[^}]*})+?|;([^"+E(m)+"]*)","g"),function(q,ne,ye){return ne!==void 0?F(ne):" "+F("{"+ye.slice(1)+"}")}).replace(new RegExp(E(m),"g")," "),j=/(\([^()]+\))+?/g;j.test(H);)H=H.replace(j,"");H=H.replace(/\d+\.(\.\.)?/g,""),H=H.replace(/\.\.\./g,""),H=H.replace(/\$\d+/g,"");for(var V=H.trim().split(new RegExp(/\s+/)).join(",").replace(/,,+/g,",").split(","),Y={},le=[],ie=0;ie<V.length;ie++){var oe=V[ie],se=ee(oe);if(se!==void 0){Y[T.fen]=se;continue}if(ie===V.length-1&&e.POSSIBLE_RESULTS.indexOf(oe)!==-1){Object.keys(B).length&&typeof B.Result>"u"&&(B.Result=oe);continue}var ae=w(T,V[ie],{sloppy:P});if(ae===null)return null;le.push({move:ae,state:T});var W=J(T,ae);if(!W)return null;T=W}return[T,B,Y,le]}I.loadPgn=c;function s(u,f){if(!f||(f=f.toLowerCase(),!n.isSquare(f)))return null;var p=e.SQUARES[f],m=u.board[p];return m?v(m):null}I.getPiece=s;function a(u){return{to:u.to,from:u.from,color:u.color,flags:u.flags,piece:u.piece,captured:u.captured,promotion:u.promotion,san:u.san}}I.cloneMove=a;function v(u){return{color:u.color,type:u.type}}I.clonePiece=v;function l(u,f,p){var m=f.type,y=f.color;if(!m||!y||!p||(m=m.toLowerCase(),y=y.toLowerCase(),p=p.toLowerCase(),!n.isPieceSymbol(m)||!n.isColor(y)||!n.isSquare(p)))return null;var P=u.clone(),E=e.SQUARES[p];return m===e.KING&&P.kings[y]!==e.EMPTY&&P.kings[y]!==E?null:(P.board[E]={type:m,color:y},m===e.KING&&(P.kings[y]=E),P)}I.putPiece=l;function S(u,f){if(!f||(f=f.toLowerCase(),!n.isSquare(f)))return null;var p=e.SQUARES[f],m=u.board[p];if(!m)return null;var y=u.clone(),P=m.type,E=m.color;return P===e.KING&&(y.kings[E]=e.EMPTY),delete y.board[p],y}I.removePiece=S;function d(u,f){var p,m;f===void 0&&(f={});var y=f.legal,P=y===void 0?!0:y,E=function(ye,be,_e,he,Se){var de=ye[_e];if(de&&de.type===e.PAWN&&(n.rank(he)===e.RANK_8||n.rank(he)===e.RANK_1))for(var Xe=[e.QUEEN,e.ROOK,e.BISHOP,e.KNIGHT],Le=0,Ot=Xe.length;Le<Ot;Le++)be.push(te(u,_e,he,Se,Xe[Le]));else be.push(te(u,_e,he,Se))},C=[],h=u.turn,g=n.swapColor(h),T={b:e.RANK_7,w:e.RANK_2},B=e.SQUARES.a8,W=e.SQUARES.h1,L=!1,K=f.square;if(K)if(K=K.toLowerCase(),n.isSquare(K))B=W=e.SQUARES[K],L=!0;else return[];for(var F=B;F<=W;F++){if(F&136){F+=7;continue}var ee=u.board[F];if(!(!ee||ee.color!==h))if(ee.type===e.PAWN){var H=F+e.PAWN_OFFSETS[h][0];if(!u.board[H]){E(u.board,C,F,H,e.BITS.NORMAL);var j=F+e.PAWN_OFFSETS[h][1];T[h]===n.rank(F)&&!u.board[j]&&E(u.board,C,F,j,e.BITS.BIG_PAWN)}for(var V=2;V<4;V++){var Y=F+e.PAWN_OFFSETS[h][V];Y&136||(u.board[Y]&&((p=u.board[Y])===null||p===void 0?void 0:p.color)===g?E(u.board,C,F,Y,e.BITS.CAPTURE):Y===u.ep_square&&E(u.board,C,F,u.ep_square,e.BITS.EP_CAPTURE))}}else for(var V=0,le=e.PIECE_OFFSETS[ee.type].length;V<le;V++)for(var ie=e.PIECE_OFFSETS[ee.type][V],oe=F;oe+=ie,!(oe&136);){if(!u.board[oe])E(u.board,C,F,oe,e.BITS.NORMAL);else{if(((m=u.board[oe])===null||m===void 0?void 0:m.color)===h)break;E(u.board,C,F,oe,e.BITS.CAPTURE);break}if(ee.type==="n"||ee.type==="k")break}}if(!L||W===u.kings[h]){if(u.castling[h]&e.BITS.KSIDE_CASTLE){var se=u.kings[h],ae=se+2;!u.board[se+1]&&!u.board[ae]&&!N(u,g,u.kings[h])&&!N(u,g,se+1)&&!N(u,g,ae)&&E(u.board,C,u.kings[h],ae,e.BITS.KSIDE_CASTLE)}if(u.castling[h]&e.BITS.QSIDE_CASTLE){var se=u.kings[h],ae=se-2;!u.board[se-1]&&!u.board[se-2]&&!u.board[se-3]&&!N(u,g,u.kings[h])&&!N(u,g,se-1)&&!N(u,g,ae)&&E(u.board,C,u.kings[h],ae,e.BITS.QSIDE_CASTLE)}}if(!P)return C;for(var q=[],F=0,le=C.length;F<le;F++){var ne=J(u,C[F]);O(ne,h)||q.push(C[F])}return q}I.generateMoves=d;function A(u,f,p){var m;p===void 0&&(p={});var y=p.sloppy,P=y===void 0?!1:y,E=p.checkPromotion,C=E===void 0?!0:E,h="";if(f.flags&e.BITS.KSIDE_CASTLE)h="O-O";else if(f.flags&e.BITS.QSIDE_CASTLE)h="O-O-O";else{var g=r(u,f,P);f.piece!==e.PAWN&&(h+=f.piece.toUpperCase()+g),f.flags&(e.BITS.CAPTURE|e.BITS.EP_CAPTURE)&&(f.piece===e.PAWN&&(h+=n.algebraic(f.from)[0]),h+="x"),h+=n.algebraic(f.to),C&&f.flags&e.BITS.PROMOTION&&(h+="="+((m=f.promotion)===null||m===void 0?void 0:m.toUpperCase()))}var T=J(u,f);return U(T)&&(Q(T)?h+="#":h+="+"),h}I.moveToSan=A;function w(u,f,p){p===void 0&&(p={});var m=p.sloppy,y=m===void 0?!1:m,P=p.checkPromotion,E=P===void 0?!0:P,C=n.strippedSan(f),h,g,T,B,W;y&&(h=C.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),h&&(g=h[1],T=h[2],B=h[3],W=h[4]));for(var L=d(u,{square:T}),K=0,F=L.length;K<F;K++){var ee=A(u,L[K],{checkPromotion:E});if(C===n.strippedSan(ee)||y&&C===n.strippedSan(A(u,L[K],p))||T&&B&&n.isSquare(T)&&n.isSquare(B)&&h&&(!g||g.toLowerCase()==L[K].piece)&&e.SQUARES[T]==L[K].from&&e.SQUARES[B]==L[K].to&&(!E||!W||W.toLowerCase()==L[K].promotion))return L[K]}return null}I.sanToMove=w;function $(u,f){var p=a(f),m="";for(var y in e.BITS)n.isFlagKey(y)&&e.BITS[y]&p.flags&&(m+=e.FLAGS[y]);return{to:n.algebraic(p.to),from:n.algebraic(p.from),color:p.color,flags:m,piece:p.piece,san:A(u,p),captured:p.captured,promotion:p.promotion}}I.makePretty=$;function N(u,f,p){for(var m,y=e.SQUARES.a8;y<=e.SQUARES.h1;y++){if(y&136){y+=7;continue}if(!(u.board[y]==null||((m=u.board[y])===null||m===void 0?void 0:m.color)!==f)){var P=u.board[y],E=y-p,C=E+119;if(P&&e.ATTACKS[C]&1<<e.SHIFTS[P.type]){if(P.type===e.PAWN){if(E>0){if(P.color===e.WHITE)return!0}else if(P.color===e.BLACK)return!0;continue}if(P.type==="n"||P.type==="k")return!0;for(var h=e.RAYS[C],g=y+h,T=!1;g!==p;){if(u.board[g]){T=!0;break}g+=h}if(!T)return!0}}}return!1}I.isAttacked=N;function O(u,f){return N(u,n.swapColor(f),u.kings[f])}I.isKingAttacked=O;function U(u){return O(u,u.turn)}I.inCheck=U;function Q(u){return U(u)&&d(u).length===0}I.inCheckmate=Q;function re(u){return!U(u)&&d(u).length===0}I.inStalemate=re;function X(u){for(var f={},p=[],m=0,y=0,P=e.SQUARES.a8;P<=e.SQUARES.h1;P++){if(y=(y+1)%2,P&136){P+=7;continue}var E=u.board[P];E&&(f[E.type]=E.type in f?f[E.type]+1:1,E.type===e.BISHOP&&p.push(y),m++)}if(m===2)return!0;if(m===3&&(f[e.BISHOP]===1||f[e.KNIGHT]===1))return!0;if(m===f[e.BISHOP]+2){for(var C=0,h=p.length,P=0;P<h;P++)C+=p[P];if(C===0||C===h)return!0}return!1}I.insufficientMaterial=X;function J(u,f){var p=u.clone(),m=p.turn,y=n.swapColor(m);p.board[f.to]=p.board[f.from],delete p.board[f.from],f.flags&e.BITS.EP_CAPTURE&&(p.turn===e.BLACK?delete p.board[f.to-16]:delete p.board[f.to+16]),f.flags&e.BITS.PROMOTION&&f.promotion&&n.isPieceSymbol(f.promotion)&&(p.board[f.to]={type:f.promotion,color:m});var P=p.board[f.to];if(P&&P.type===e.KING){if(p.kings[P.color]=f.to,f.flags&e.BITS.KSIDE_CASTLE){var E=f.to-1,C=f.to+1;p.board[E]=p.board[C],delete p.board[C]}else if(f.flags&e.BITS.QSIDE_CASTLE){var E=f.to+1,C=f.to-2;p.board[E]=p.board[C],delete p.board[C]}p.castling[m]=0}if(p.castling[m]){for(var h=0,g=e.ROOKS[m].length;h<g;h++)if(f.from===e.ROOKS[m][h].square&&p.castling[m]&e.ROOKS[m][h].flag){p.castling[m]^=e.ROOKS[m][h].flag;break}}if(p.castling[y]){for(var h=0,g=e.ROOKS[y].length;h<g;h++)if(f.to===e.ROOKS[y][h].square&&p.castling[y]&e.ROOKS[y][h].flag){p.castling[y]^=e.ROOKS[y][h].flag;break}}return f.flags&e.BITS.BIG_PAWN?p.turn==="b"?p.ep_square=f.to-16:p.ep_square=f.to+16:p.ep_square=e.EMPTY,f.piece===e.PAWN||f.flags&(e.BITS.CAPTURE|e.BITS.EP_CAPTURE)?p.half_moves=0:p.half_moves++,p.turn===e.BLACK&&p.move_number++,p.turn=n.swapColor(p.turn),p}I.makeMove=J;function te(u,f,p,m,y){var P,E={color:u.turn,from:f,to:p,flags:m,piece:u.board[f].type};return y&&n.isPieceSymbol(y)&&(E.flags|=e.BITS.PROMOTION,E.promotion=y),u.board[p]?E.captured=(P=u.board[p])===null||P===void 0?void 0:P.type:m&e.BITS.EP_CAPTURE&&(E.captured=e.PAWN),E}I.buildMove=te;function k(u,f){f===void 0&&(f=`
`);var p=e.RANKS.map(function(m){for(var y=u.slice(m*16,m*16+8),P=[],E=0,C=y;E<C.length;E++){var h=C[E];P.push(h?" "+n.symbol(h)+" ":" . ")}var g=P.join("");return"87654321"[m]+" |"+g+"|"});return["  +------------------------+",p.join(f),"  +------------------------+","    a  b  c  d  e  f  g  h"].join(f)}I.ascii=k;function M(u){for(var f=[],p=[],m=e.SQUARES.a8;m<=e.SQUARES.h1;m++){var y=u[m];y==null?p.push(null):p.push({type:y.type,color:y.color}),m+1&136&&(f.push(p),p=[],m+=8)}return f}I.getBoard=M;function R(u,f,p){p===void 0&&(p={});var m=p.checkPromotion,y=m===void 0?!0:m;if(typeof f=="string")return w(u,f,p);if(typeof f=="object")for(var P=d(u,{square:f.from}),E=0,C=P;E<C.length;E++){var h=C[E];if(f.from===n.algebraic(h.from)&&f.to===n.algebraic(h.to)&&(!y||!("promotion"in h)||f.promotion===h.promotion))return h}return null}return I.validateMove=R,I}var pt;function Ht(){if(pt)return ce;pt=1;var e=ce&&ce.__assign||function(){return e=Object.assign||function(c){for(var s,a=1,v=arguments.length;a<v;a++){s=arguments[a];for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(c[l]=s[l])}return c},e.apply(this,arguments)},t=ce&&ce.__spreadArrays||function(){for(var c=0,s=0,a=arguments.length;s<a;s++)c+=arguments[s].length;for(var v=Array(c),l=0,s=0;s<a;s++)for(var S=arguments[s],d=0,A=S.length;d<A;d++,l++)v[l]=S[d];return v};Object.defineProperty(ce,"__esModule",{value:!0}),ce.Chess=void 0;var n=Mt(),r=Ye(),i=Ze(),o=Te(),_=(function(){function c(s){if(s===void 0&&(s=o.DEFAULT_POSITION),this._state=new r.State,this._history=[],this._header={},this._comments={},!this.load(s))throw new Error("Error loading fen")}return Object.defineProperty(c.prototype,"state",{get:function(){return this._state.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"states",{get:function(){return t(this._history.map(function(s){return s.state.clone()}),[this.state])},enumerable:!1,configurable:!0}),c.prototype.load=function(s,a){a===void 0&&(a=!1);var v=n.loadFen(s);return v?(this._state=v,this._history=[],a||(this._header={}),this._comments={},this.updateSetup(),!0):!1},c.prototype.clear=function(s){s===void 0&&(s=!1),this._state=new r.State,this._history=[],s||(this._header={}),this._comments={},this.updateSetup()},c.prototype.reset=function(){this.load(o.DEFAULT_POSITION)},c.prototype.get=function(s){return n.getPiece(this._state,s)},c.prototype.put=function(s,a){var v=n.putPiece(this._state,s,a);return v?(this._state=v,this.updateSetup(),!0):!1},c.prototype.remove=function(s){var a=n.getPiece(this._state,s);if(!a)return null;var v=n.removePiece(this._state,s);return v?(this._state=v,a):null},c.prototype.moves=function(s){var a=this;s===void 0&&(s={});var v=s.square,l=s.verbose,S=l===void 0?!1:l,d=n.generateMoves(this._state,{square:v});return S?d.map(function(A){return n.makePretty(a._state,A)}):d.map(function(A){return n.moveToSan(a._state,A)})},c.prototype.fen=function(){return this._state.fen},c.prototype.inCheck=function(){return n.inCheck(this._state)},c.prototype.inCheckmate=function(){return n.inCheckmate(this._state)},c.prototype.inStalemate=function(){return n.inStalemate(this._state)},c.prototype.insufficientMaterial=function(){return n.insufficientMaterial(this._state)},c.prototype.inThreefoldRepetition=function(){for(var s={},a=function(d){var A=d.fen.split(" ").slice(0,4).join(" ");return s[A]=A in s?s[A]+1:1,s[A]>=3},v=0,l=this._history;v<l.length;v++){var S=l[v].state;if(a(S))return!0}return a(this._state)},c.prototype.inDraw=function(){return this._state.half_moves>=100||this.inStalemate()||this.insufficientMaterial()||this.inThreefoldRepetition()},c.prototype.gameOver=function(){return this.inCheckmate()||this.inDraw()},c.prototype.board=function(){return n.getBoard(this._state.board)},c.prototype.pgn=function(s){return s===void 0&&(s={}),n.getPgn(this._state,this._header,this._comments,this._history,s)},c.prototype.loadPgn=function(s,a){a===void 0&&(a={});var v=n.loadPgn(s,a);if(!v)return!1;var l=v[0],S=v[1],d=v[2],A=v[3];return this._state=l,this._header=S,this._comments=d,this._history=A,!0},c.prototype.header=function(){return this._header},c.prototype.setHeader=function(s){this._header=s},c.prototype.addHeader=function(s,a){this._header[s]=a},c.prototype.removeHeader=function(s){delete this._header[s]},c.prototype.clearHeader=function(){this._header={}},c.prototype.ascii=function(s){return s===void 0&&(s=`
`),n.ascii(this._state.board,s)},c.prototype.turn=function(){return this._state.turn},c.prototype.move=function(s,a){a===void 0&&(a={});var v=n.validateMove(this._state,s,a);if(!v)return null;var l=n.makePretty(this._state,v);return a.dry_run||this.makeMove(v),l},c.prototype.validateMoves=function(s,a){a===void 0&&(a={});for(var v=[],l=this._state,S=0,d=s;S<d.length;S++){var A=d[S],w=n.validateMove(l,A,a);if(!w)return null;v.push(n.makePretty(l,w)),l=n.makeMove(l,w)}return v},c.prototype.isPromotion=function(s,a){a===void 0&&(a={});var v=n.validateMove(this._state,s,e(e({},a),{checkPromotion:!1}));return v?!!(v.flags&o.BITS.PROMOTION):!1},c.prototype.undo=function(){var s=this.undoMove();return s?n.makePretty(this._state,s):null},c.prototype.squareColor=function(s){if(i.isSquare(s)){var a=o.SQUARES[s];return(i.rank(a)+i.file(a))%2===0?"light":"dark"}return null},c.prototype.history=function(s){s===void 0&&(s={});var a=s.verbose,v=a===void 0?!1:a;if(!this._history.length)return[];var l;return v?this._history.map(function(S){var d=S.move;return l=S.state,n.makePretty(l,d)}):this._history.map(function(S){var d=S.move;return l=S.state,n.moveToSan(l,d)})},c.prototype.getComment=function(s){return s=s||this.fen(),this._comments[s]},c.prototype.getComments=function(){var s=this;return this.pruneComments(),Object.keys(this._comments).map(function(a){return{fen:a,comment:s._comments[a]}})},c.prototype.setComment=function(s,a){a=a||this.fen(),this._comments[a]=s.replace("{","[").replace("}","]")},c.prototype.deleteComment=function(s){s=s||this.fen();var a=this._comments[s];return delete this._comments[s],a},c.prototype.deleteComments=function(){var s=this;return this.pruneComments(),Object.keys(this._comments).map(function(a){var v=s._comments[a];return delete s._comments[a],{fen:a,comment:v}})},c.prototype.validateFen=function(s){return i.validateFen(s)},c.prototype.clone=function(){var s=new c;return s._state=this._state,s._history=t(this._history),s._header=e({},this._header),s._comments=e({},this._comments),s},c.prototype.perft=function(s){for(var a=n.generateMoves(this._state,{legal:!1}),v=0,l=this._state.turn,S=0,d=a.length;S<d;S++){if(this.makeMove(a[S]),!this.kingAttacked(l))if(s-1>0){var A=this.perft(s-1);v+=A}else v++;this.undoMove()}return v},c.prototype.updateSetup=function(){var s=this._state.fen;this._history.length>0||(s!==o.DEFAULT_POSITION?(this._header.SetUp="1",this._header.FEN=s):(delete this._header.SetUp,delete this._header.FEN))},c.prototype.pruneComments=function(){var s=this,a={},v=function(S){S in s._comments&&(a[S]=s._comments[S])};this._history.forEach(function(S){var d=S.state;l=d,v(l.fen)});var l=this._state;v(l.fen),this._comments=a},c.prototype.strippedSan=function(s){return s.replace(/=/,"").replace(/[+#]?[?!]*$/,"")},c.prototype.attacked=function(s,a){return n.isAttacked(this._state,s,a)},c.prototype.kingAttacked=function(s){return this.attacked(i.swapColor(s),this._state.kings[s])},c.prototype.makeMove=function(s){this._history.push({move:s,state:this._state}),this._state=n.makeMove(this._state,s)},c.prototype.undoMove=function(){var s=this._history.pop();return s==null?null:(this._state=s.state,s.move)},c})();return ce.Chess=_,ce}var vt;function zt(){return vt||(vt=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Ht();Object.defineProperty(e,"Chess",{enumerable:!0,get:function(){return t.Chess}});var n=Ye();Object.defineProperty(e,"State",{enumerable:!0,get:function(){return n.State}});var r=Te();Object.defineProperty(e,"WHITE",{enumerable:!0,get:function(){return r.WHITE}}),Object.defineProperty(e,"BLACK",{enumerable:!0,get:function(){return r.BLACK}}),Object.defineProperty(e,"PAWN",{enumerable:!0,get:function(){return r.PAWN}}),Object.defineProperty(e,"KNIGHT",{enumerable:!0,get:function(){return r.KNIGHT}}),Object.defineProperty(e,"BISHOP",{enumerable:!0,get:function(){return r.BISHOP}}),Object.defineProperty(e,"ROOK",{enumerable:!0,get:function(){return r.ROOK}}),Object.defineProperty(e,"QUEEN",{enumerable:!0,get:function(){return r.QUEEN}}),Object.defineProperty(e,"KING",{enumerable:!0,get:function(){return r.KING}}),Object.defineProperty(e,"EMPTY",{enumerable:!0,get:function(){return r.EMPTY}}),Object.defineProperty(e,"SQUARES",{enumerable:!0,get:function(){return r.SQUARES}}),Object.defineProperty(e,"FLAGS",{enumerable:!0,get:function(){return r.FLAGS}}),Object.defineProperty(e,"BITS",{enumerable:!0,get:function(){return r.BITS}});var i=Ze();Object.defineProperty(e,"rank",{enumerable:!0,get:function(){return i.rank}}),Object.defineProperty(e,"file",{enumerable:!0,get:function(){return i.file}}),Object.defineProperty(e,"algebraic",{enumerable:!0,get:function(){return i.algebraic}})})(Fe)),Fe}var pe=zt();const jt="3.1.1";class ue{constructor(t,n){this._currentBannedMove=null,this._history=[],this._ply=1,this._indicatorConfig={pgn:!0,serialization:!0,san:!0},this.chess=new pe.Chess,n?this.loadFromPGN(n):t&&this.loadFromFEN(t)}getPly(){return this._ply}getActivePlayer(){switch((this._ply-1)%4+1){case 1:return"black";case 2:return"white";case 3:return"white";case 4:return"black";default:return"black"}}getActionType(){return this._ply%2===1?"ban":"move"}get turn(){return this.getActivePlayer()}get currentBannedMove(){return this._currentBannedMove}nextActionType(){return this.getActionType()}play(t){try{return"ban"in t?this.playBan(t.ban):this.playMove(t.move)}catch(n){return{success:!1,error:n instanceof Error?n.message:"Unknown error"}}}playBan(t){if(this.gameOver())return{success:!1,error:"Game is over"};if(this.getActionType()!=="ban")return{success:!1,error:"Expected a move, not a ban"};if(!this.legalBans().some(d=>d.from===t.from&&d.to===t.to))return{success:!1,error:`Invalid ban: ${t.from}-${t.to}`};this._currentBannedMove=t;const i=new pe.Chess(this.chess.fen()),_=i.moves({verbose:!0}).filter(d=>!(d.from===t.from&&d.to===t.to)),c=_.length===0&&i.inCheck(),s=_.length===0&&!i.inCheck(),a=i.inCheck()&&_.length>0,v={check:a,checkmate:c,stalemate:s,gameOver:c||s,banCausedCheckmate:c,banCausedStalemate:s};let l=`${t.from}${t.to}`;this._indicatorConfig.san&&(c?l+="#":s?l+="=":a&&(l+="+"));const S={ply:this._ply,player:this.getActivePlayer(),actionType:"ban",action:t,fen:this.fen(),bannedMove:t,san:l,flags:v};return this._history.push(S),this._ply++,{success:!0,action:{ban:t},san:this._indicatorConfig.san?l:`${t.from}${t.to}`,newFen:this.fen(),flags:v,check:v.check,checkmate:v.checkmate,stalemate:v.stalemate,gameOver:v.gameOver,draw:v.draw}}playMove(t){if(this.gameOver())return{success:!1,error:"Game is over"};if(this.getActionType()!=="move")return{success:!1,error:"Expected a ban, not a move"};if(this.isBannedMove(t))return{success:!1,error:`Move ${t.from}-${t.to} is banned`};const n=this.chess.move({from:t.from,to:t.to,promotion:t.promotion});if(!n)return{success:!1,error:`Invalid move: ${t.from}-${t.to}`};const r={check:this.chess.inCheck(),checkmate:this.chess.inCheckmate(),stalemate:this.chess.inStalemate(),draw:this.chess.inDraw(),gameOver:this.chess.gameOver(),insufficientMaterial:this.chess.insufficientMaterial(),threefoldRepetition:this.chess.inThreefoldRepetition(),fiftyMoveRule:this.chess.inDraw()&&!this.chess.inStalemate()&&!this.chess.insufficientMaterial()},i={ply:this._ply,player:this.getActivePlayer(),actionType:"move",action:t,san:n.san,fen:this.fen(),bannedMove:this._currentBannedMove,flags:r};this._history.push(i),this._currentBannedMove=null,this._ply++;let o=n.san;return!this._indicatorConfig.san&&o&&(o=o.replace(/[+#=]$/,"")),{success:!0,action:{move:t},san:o,newFen:this.fen(),flags:r,check:r.check,checkmate:r.checkmate,stalemate:r.stalemate,gameOver:r.gameOver,draw:r.draw}}isBannedMove(t){return this._currentBannedMove?this._currentBannedMove.from===t.from&&this._currentBannedMove.to===t.to:!1}getLegalActions(){return this.gameOver()?[]:this.getActionType()==="ban"?this.legalBans().map(t=>({ban:t})):this.legalMoves().map(t=>({move:t}))}legalMoves(){if(this.gameOver())return[];if(this.getActionType()!=="move")return[];const n=this.chess.moves({verbose:!0}).map(r=>({from:r.from,to:r.to,promotion:r.promotion}));return this._currentBannedMove?n.filter(r=>!this.isBannedMove(r)):n}legalBans(){if(this.gameOver())return[];if(this.getActionType()!=="ban")return[];const n=new pe.Chess(this.chess.fen()).moves({verbose:!0}),r=new Map;return n.forEach(i=>{const o=`${i.from}-${i.to}`;r.has(o)||r.set(o,{from:i.from,to:i.to})}),Array.from(r.values())}inCheck(){return this.chess.inCheck()}inCheckmate(){return this.chess.inCheckmate()}inStalemate(){return this.chess.inStalemate()}gameOver(){return this.inCheckmate()||this.inStalemate()||this.inDraw()}inDraw(){return this.chess.inDraw()}inThreefoldRepetition(){return this.chess.inThreefoldRepetition()}insufficientMaterial(){return this.chess.insufficientMaterial()}currentPlayer(){return this.turn}setIndicatorConfig(t){this._indicatorConfig={...this._indicatorConfig,...t}}getIndicatorConfig(){return{...this._indicatorConfig}}nextMoveColor(){return this.chess.turn()==="w"?"white":"black"}getGameIndicator(){const t=this.getGameFlags();return t.checkmate?"#":t.stalemate||t.draw?"=":t.check?"+":""}getGameFlags(){const t=this._history[this._history.length-1],n=t?.flags?.banCausedCheckmate||!1,r=t?.flags?.banCausedStalemate||!1;return{check:this.chess.inCheck(),checkmate:this.chess.inCheckmate(),stalemate:this.chess.inStalemate(),draw:this.chess.inDraw(),gameOver:this.chess.gameOver(),insufficientMaterial:this.chess.insufficientMaterial(),threefoldRepetition:this.chess.inThreefoldRepetition(),fiftyMoveRule:this.chess.inDraw()&&!this.chess.inStalemate()&&!this.chess.insufficientMaterial()&&!this.chess.inThreefoldRepetition(),banCausedCheckmate:n,banCausedStalemate:r}}fen(){const t=this.chess.fen();let n=this._ply.toString();this._currentBannedMove&&(n+=`:${this._currentBannedMove.from}${this._currentBannedMove.to}`);const r=this.getGameIndicator();return n+=r,`${t} ${n}`}pgn(){let t="",n="";for(let r=0;r<this._history.length;r++){const i=this._history[r];let o=1;if(i.actionType==="move"&&(i.player==="white"?o=Math.floor((i.ply-2)/4)+1:o=Math.floor((i.ply-4)/4)+1),i.actionType==="ban"){const _=i.action;let c=`${_.from}${_.to}`;if(this._indicatorConfig.pgn&&i.san){const s=i.san.match(/[+#=]$/)?.[0];s&&(c+=s)}n+=`{banning: ${c}} `}else{i.player==="white"&&(n=`${o}. ${n}`);let _=i.san||"";!this._indicatorConfig.pgn&&_&&(_=_.replace(/[+#=]$/,"")),n+=`${_} `,i.player==="black"&&(t+=n,n="")}}if(n){const r=this._history.length>0?Math.floor((this._history[this._history.length-1].ply+1)/2):1;n.startsWith(`${r}.`)||(n=`${r}. ${n}`),t+=n}if(this._history.length>0){const r=this._history[this._history.length-1];if(r.actionType==="move"&&r.san){if(r.san.endsWith("#")){const i=r.player==="white"?"1-0":"0-1";t=t.trim()+" "+i}}else if(r.actionType==="ban"&&this.gameOver())if(this.inCheckmate()){const i=this.chess.turn()==="w"?"0-1":"1-0";t=t.trim()+" "+i}else this.inStalemate()&&(t=t.trim()+" 1/2-1/2")}return t.trim()}history(){return[...this._history]}reset(){this.chess=new pe.Chess,this._currentBannedMove=null,this._history=[],this._ply=1}ascii(){let t=this.chess.ascii();return this._currentBannedMove&&(t+=`
Banned: ${this._currentBannedMove.from}-${this._currentBannedMove.to}`),t+=`
Ply: ${this._ply} (${this.getActionType()} by ${this.getActivePlayer()})`,t}static serializeAction(t,n){let r;if("ban"in t)r=`b:${t.ban.from}${t.ban.to}`;else{const i=t.move;r=`m:${i.from}${i.to}${i.promotion||""}`}return n&&(r+=n),r}static deserializeAction(t){const n=t.match(/^([bm]):([a-h][1-8])([a-h][1-8])([qrbn])?([+#=])?$/);if(!n)throw new Error(`Invalid serialized action format: ${t}`);const[,r,i,o,_,c]=n;return r==="b"?{ban:{from:i,to:o}}:{move:_?{from:i,to:o,promotion:_}:{from:i,to:o}}}getLastActionSerialized(){if(this._history.length===0)return null;const t=this._history[this._history.length-1],n=t.actionType==="ban"?{ban:t.action}:{move:t.action};if(!this._indicatorConfig.serialization)return ue.serializeAction(n);let r;if(t.san){const i=t.san.match(/[+#=]$/);i&&(r=i[0])}return ue.serializeAction(n,r)}getSyncState(){return{fen:this.fen(),lastAction:this.getLastActionSerialized()||void 0,ply:this._ply}}playSerializedAction(t){try{const n=ue.deserializeAction(t);return this.play(n)}catch(n){return{success:!1,error:n instanceof Error?n.message:"Invalid serialized action"}}}loadFromSyncState(t){this.loadFromFEN(t.fen),this._ply=t.ply}getActionLog(){return this._history.map(t=>{if(t.actionType==="ban"){const n=t.action;let r=`b:${n.from}${n.to}`;if(t.san&&this._indicatorConfig.serialization){const i=t.san.match(/[+#=]$/);i&&(r+=i[0])}return r}else return t.san||`${t.action.from}${t.action.to}`})}getActionHistory(){return this._history.map((t,n)=>{const r=t.actionType==="ban"?{ban:t.action}:{move:t.action};if(!this._indicatorConfig.serialization)return ue.serializeAction(r);let i;return t.actionType==="move"?t.san?.endsWith("#")?i="#":t.san?.endsWith("+")&&(i="+"):n===this._history.length-1&&(this.gameOver()?this.inCheckmate()?i="#":this.inStalemate()&&(i="="):this.nextActionType()==="move"&&this.chess.inCheck()&&(i="+")),ue.serializeAction(r,i)})}static replayFromActions(t,n){const r=new ue(n);for(const i of t){const o=r.playSerializedAction(i);if(!o.success)throw new Error(`Failed to replay action ${i}: ${o.error}`)}return r}loadFromFEN(t){const n=t.split(" ");if(n.length<7){this.chess=new pe.Chess(t);return}const r=n.slice(0,6).join(" ");let i=n[6];if(this.chess=new pe.Chess(r),i&&i!=="-"){const o=i[i.length-1];if((o==="+"||o==="#"||o==="=")&&(i=i.slice(0,-1)),i.includes(":")){const[_,c]=i.split(":");this._ply=parseInt(_,10)||1,c&&c.length>=4&&(this._currentBannedMove={from:c.substring(0,2),to:c.substring(2,4)})}else{const _=parseInt(i,10);if(!isNaN(_))this._ply=_;else if(i.startsWith("b:")||i.startsWith("w:")){const[c,s]=i.split(":");s!=="ban"&&s.length===4&&(this._currentBannedMove={from:s.substring(0,2),to:s.substring(2,4)})}}}}loadFromPGN(t){this.reset();const n=t.match(/\{banning:\s*[a-h][1-8][a-h][1-8]\}|[KQRBN]?[a-h]?[1-8]?x?[a-h][1-8](?:=[QRBN])?[+#]?|\d+\./g);if(n){for(const r of n)if(!/^\d+\.$/.test(r)){if(r.includes("banning:")){const i=r.match(/([a-h][1-8])([a-h][1-8])/);if(i){const o={from:i[1],to:i[2]};this.play({ban:o})}}else if(/^[KQRBN]?[a-h]?[1-8]?x?[a-h][1-8]/.test(r)){const o=this.legalMoves().find(_=>{const s=new pe.Chess(this.chess.fen()).move({from:_.from,to:_.to,promotion:_.promotion});return s&&s.san===r});o&&this.play({move:o})}}}}}ue.VERSION=jt;const Gt=[{id:"computer",name:"Computer",icon:"🤖"},{id:"opening",name:"Opening",icon:"📚"},{id:"settings",name:"Settings",icon:"⚙️"}];function Vt({fen:e,moveHistory:t,currentMoveIndex:n,engineManager:r,onMoveSelect:i,onLineSelect:o}){const[_,c]=Z("computer"),[s,a]=Z([]),[v,l]=Z("1"),[S,d]=Z({multiPV:3,depth:18,enabled:!0}),[A,w]=Z(null),$={e4:{name:"King's Pawn",eco:"B00"},"e4 e5":{name:"King's Pawn Game",eco:"C20"},"e4 e5 Nf3":{name:"King's Knight Opening",eco:"C20"},"e4 e5 Nf3 Nc6":{name:"King's Knight Opening",eco:"C20"},"e4 e5 Nf3 Nc6 Bb5":{name:"Ruy Lopez",eco:"C60"},"e4 e5 Nf3 Nc6 Bc4":{name:"Italian Game",eco:"C50"},"e4 e5 Nf3 f5":{name:"Latvian Gambit",eco:"C40"},"e4 c5":{name:"Sicilian Defense",eco:"B20"},"e4 c6":{name:"Caro-Kann Defense",eco:"B10"},"e4 e6":{name:"French Defense",eco:"C00"},d4:{name:"Queen's Pawn",eco:"D00"},"d4 d5":{name:"Queen's Pawn Game",eco:"D00"},"d4 d5 c4":{name:"Queen's Gambit",eco:"D06"},"d4 Nf6":{name:"Indian Defense",eco:"A40"},"d4 Nf6 c4":{name:"Queen's Indian Setup",eco:"A47"},"d4 f5":{name:"Dutch Defense",eco:"A80"},Nf3:{name:"Réti Opening",eco:"A04"},c4:{name:"English Opening",eco:"A10"},f4:{name:"Bird's Opening",eco:"A02"},b3:{name:"Nimzo-Larsen Attack",eco:"A01"},g3:{name:"King's Indian Attack",eco:"A07"},Nc3:{name:"Van't Kruijs Opening",eco:"A00"}};Be(()=>r.onEvent(M=>{switch(M.type){case"evaluation":a(R=>{const u=`stockfish-${M.multiPV}`,f=R.findIndex(m=>m.id===u),p={id:u,evaluation:M.evaluation,multipv:M.multiPV,isSelected:v===u};if(f>=0){const m=[...R];return m[f]=p,m}else return[...R,p].sort((m,y)=>m.multipv-y.multipv)});break;case"error":console.error("Stockfish error:",M.error);break}}),[r,v]),Be(()=>{if(S.enabled&&e&&r.analyzePosition(e),t.length<=10){const k=t.map(R=>U(R)).join(" ");let M=$[k];if(!M&&k.includes(" ")){const R=k.split(" ");for(let u=R.length-1;u>0;u--){const f=R.slice(0,u).join(" ");if($[f]){M=$[f];break}}}M?w({name:M.name,eco:M.eco,moves:k||"Starting position"}):t.length===0?w({name:"Starting Position",eco:"",moves:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq -"}):w(null)}else w(null)},[e,S.enabled,r,t]);const N=(k,M)=>{if(M!==void 0)return{text:`M${Math.abs(M)}`,className:"mate"};const R=k/100;return Math.abs(R)>=10?{text:R>0?"+−":"−+",className:R>0?"positive":"negative"}:{text:R>=0?`+${R.toFixed(1)}`:R.toFixed(1),className:R>0?"positive":"negative"}},O=k=>{if("move"in k){const{from:M,to:R,promotion:u}=k.move;return u?`${M}${R}=${u.toUpperCase()}`:`${M}${R}`}else{const{from:M,to:R}=k.ban;return`${M}${R}×`}},U=k=>{if("move"in k){const{from:M,to:R,promotion:u}=k.move,f=M[0]===M[0].toLowerCase()?"":M[0].toUpperCase();return u?`${f}${R}=${u.toUpperCase()}`:`${f}${R}`}else{const{from:M,to:R}=k.ban;return`${M}-${R}×`}},Q=k=>k.slice(0,6).join(" "),re=Dt(()=>{const k=[];for(let M=0;M<t.length;M+=2)k.push({number:Math.floor(M/2)+1,white:t[M],black:t[M+1],whiteIndex:M,blackIndex:M+1});return k},[t]),X=k=>{l(k.id),o?.(k)},J=k=>{i?.(k)},te=k=>{const M={...S,...k};d(M),r.updateConfig({multiPV:M.multiPV,depth:M.depth})};return b("div",{className:"lichess-right-panel",children:[b("div",{className:"lichess-panel-tabs",children:Gt.map(k=>b("div",{className:`lichess-tab ${_===k.id?"active":""}`,onClick:()=>c(k.id),children:[b("span",{children:k.icon}),b("span",{children:k.name})]},k.id))}),b("div",{className:"lichess-analysis-content",children:[_==="computer"&&b(me,{children:[b("div",{className:"lichess-engine-lines",children:[s.length===0&&b("div",{className:"lichess-loading",children:"Analyzing position..."}),s.map(k=>{const M=N(k.evaluation.score,k.evaluation.mate);return b("div",{className:`lichess-engine-line ${k.isSelected?"selected":""}`,"data-multipv":k.multipv,onClick:()=>X(k),children:[b("div",{className:`lichess-line-eval ${M.className}`,children:M.text}),b("div",{className:"lichess-line-moves",children:[Q(k.evaluation.pv),k.evaluation.depth&&b("span",{style:{marginLeft:"8px",fontSize:"10px",color:"var(--lichess-text-secondary)"},children:["d",k.evaluation.depth]})]})]},k.id)})]}),b("div",{className:"lichess-eval-graph",children:b("div",{className:"lichess-eval-curve"})}),b("div",{className:"lichess-move-list",children:[re.length===0&&b("div",{className:"lichess-loading",children:"No moves yet"}),re.map(k=>b("div",{className:"lichess-move-pair",children:[b("div",{className:"lichess-move-number",children:[k.number,"."]}),k.white&&b("div",{className:`lichess-move white-move ${n===k.whiteIndex?"current":""} ${"ban"in k.white?"ban-move":""}`,onClick:()=>J(k.whiteIndex),title:`${O(k.white)} (${k.whiteIndex+1})`,children:U(k.white)}),k.black&&b("div",{className:`lichess-move black-move ${n===k.blackIndex?"current":""} ${"ban"in k.black?"ban-move":""}`,onClick:()=>J(k.blackIndex),title:`${O(k.black)} (${k.blackIndex+1})`,children:U(k.black)})]},k.number))]})]}),_==="opening"&&b("div",{className:"lichess-opening",children:A?b(me,{children:[b("div",{className:"lichess-opening-name",children:A.name}),A.eco&&b("div",{className:"lichess-opening-eco",children:A.eco}),b("div",{className:"lichess-opening-moves",children:t.length>0?b(me,{children:[b("strong",{children:"Moves:"})," ",A.moves]}):b("em",{children:"Starting position - make your first move!"})}),t.length<10&&b("div",{style:{marginTop:"12px",fontSize:"11px",color:"var(--lichess-text-secondary)",fontStyle:"italic"},children:"Opening information shown for first 10 moves"})]}):b("div",{className:"lichess-loading",children:t.length>10?"Opening phase complete - now in the middle game":"Unknown opening or position"})}),_==="settings"&&b("div",{className:"lichess-engine-settings",children:[b("div",{className:"lichess-settings-section",children:[b("h4",{style:{color:"var(--lichess-text)",marginBottom:"12px",fontSize:"13px"},children:"Engine Configuration"}),b("div",{className:"lichess-setting-row",children:[b("span",{className:"lichess-setting-label",children:[b("strong",{children:"Computer Analysis"}),b("div",{style:{fontSize:"10px",color:"var(--lichess-text-secondary)"},children:"Enable real-time position evaluation"})]}),b("label",{className:"lichess-toggle",children:[b("input",{type:"checkbox",checked:S.enabled,onChange:k=>te({enabled:k.target.checked})}),b("span",{className:"lichess-toggle-slider"})]})]}),b("div",{className:"lichess-setting-row",children:[b("span",{className:"lichess-setting-label",children:[b("strong",{children:"Multiple Lines"}),b("div",{style:{fontSize:"10px",color:"var(--lichess-text-secondary)"},children:"Show top engine variations"})]}),b("div",{className:"lichess-slider-container",children:[b("input",{type:"range",min:"1",max:"5",value:S.multiPV,onChange:k=>te({multiPV:parseInt(k.target.value)}),className:"lichess-slider",disabled:!S.enabled}),b("span",{className:"lichess-setting-value",children:S.multiPV})]})]}),b("div",{className:"lichess-setting-row",children:[b("span",{className:"lichess-setting-label",children:[b("strong",{children:"Search Depth"}),b("div",{style:{fontSize:"10px",color:"var(--lichess-text-secondary)"},children:"Maximum calculation depth"})]}),b("div",{className:"lichess-slider-container",children:[b("input",{type:"range",min:"5",max:"25",value:S.depth,onChange:k=>te({depth:parseInt(k.target.value)}),className:"lichess-slider",disabled:!S.enabled}),b("span",{className:"lichess-setting-value",children:S.depth})]})]})]}),b("div",{className:"lichess-settings-section",style:{marginTop:"20px"},children:[b("h4",{style:{color:"var(--lichess-text)",marginBottom:"8px",fontSize:"13px"},children:"Engine Status"}),b("div",{style:{fontSize:"11px",color:"var(--lichess-text-secondary)"},children:[b("div",{children:"🔥 Stockfish.js (WASM)"}),b("div",{style:{color:"var(--lichess-text-tertiary)",fontSize:"10px"},children:"World's strongest chess engine"}),b("div",{style:{marginTop:"8px"},children:["Analysis: ",S.enabled?"✅ Active":"⏸️ Paused"]})]})]})]})]})]})}class Yt{stockfishWorker=null;eventHandlers=[];config;isInitialized=!1;constructor(t){this.config={...t}}async initialize(){if(!this.isInitialized)try{const t=typeof WebAssembly=="object"&&WebAssembly.validate(Uint8Array.of(0,97,115,109,1,0,0,0));let n;if(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")n=t?"/stockfish/stockfish.wasm.js":"/stockfish/stockfish.js";else{const r="/ban-chess-gui/";n=t?`${r}stockfish/stockfish.wasm.js`:`${r}stockfish/stockfish.js`}return console.log("Loading Stockfish from:",n),this.stockfishWorker=new Worker(n),new Promise((r,i)=>{let o=!1;const _=setTimeout(()=>{i(new Error("Stockfish initialization timeout"))},15e3),c=s=>{const a=typeof s.data=="string"?s.data:s.data.toString();console.log("Stockfish:",a),a==="uciok"?(o=!0,this.stockfishWorker?.postMessage(`setoption name MultiPV value ${this.config.multiPV}`),this.stockfishWorker?.postMessage("setoption name Hash value 128"),this.stockfishWorker?.postMessage("setoption name Threads value 1"),this.stockfishWorker?.postMessage("isready")):a==="readyok"&&o&&(clearTimeout(_),this.stockfishWorker?.removeEventListener("message",c),this.stockfishWorker?.addEventListener("message",v=>{this.handleStockfishMessage(v.data)}),this.isInitialized=!0,this.emitEvent({type:"ready"}),console.log("Stockfish initialized successfully"),r())};this.stockfishWorker?.addEventListener("message",c),this.stockfishWorker?.postMessage("uci")})}catch(t){console.error("Failed to initialize Stockfish:",t),this.isInitialized=!0,this.useFallbackEngine(),this.emitEvent({type:"ready"})}}useFallbackEngine(){console.warn("Using fallback engine - Stockfish failed to load");const t={postMessage:n=>{if(n!=="stop"&&n.startsWith("position fen ")){const r=n.replace("position fen ","");setTimeout(()=>{let i=0;const o=r.split(" ")[0];for(const _ of o)switch(_){case"Q":i+=900;break;case"q":i-=900;break;case"R":i+=500;break;case"r":i-=500;break;case"B":case"N":i+=300;break;case"b":case"n":i-=300;break;case"P":i+=100;break;case"p":i-=100;break}this.handleStockfishMessage(`info depth 10 score cp ${i} nodes 100000 time 100 pv e2e4`)},100)}},terminate:()=>{},addEventListener:()=>{},removeEventListener:()=>{}};this.stockfishWorker=t}handleStockfishMessage(t){if(typeof t!="string")return;const n=t.trim().split(" ");if(n[0]==="info"&&n.includes("depth")&&n.includes("score"))try{const r=n.indexOf("depth"),i=n.indexOf("score"),o=n.indexOf("nodes"),_=n.indexOf("time"),c=n.indexOf("pv"),s=n.indexOf("multipv"),a=n.indexOf("nps"),v=parseInt(n[r+1]),l=o>=0?parseInt(n[o+1]):0,S=_>=0?parseInt(n[_+1]):0,d=s>=0?parseInt(n[s+1]):1,A=a>=0?parseInt(n[a+1]):0;let w=0,$;if(n[i+1]==="cp"){w=parseInt(n[i+2]);const O=this.lastAnalyzedFen;O&&O.split(" ")[1]==="b"&&(w=-w)}else n[i+1]==="mate"&&($=parseInt(n[i+2]),w=$>0?2e4-Math.abs($):-2e4+Math.abs($));let N=[];if(c>=0)for(let O=c+1;O<n.length;O++){const U=n[O];if(U.length>=4&&U.match(/^[a-h][1-8][a-h][1-8][qrbn]?$/))N.push(U);else break}this.emitEvent({type:"evaluation",evaluation:{score:w,depth:v,nodes:l,time:S,nps:A,pv:N.slice(0,10),mate:$},multiPV:d})}catch(r){console.warn("Failed to parse Stockfish info:",t,r)}else n[0]==="bestmove"&&n[1]&&this.emitEvent({type:"bestMove",move:n[1],ponder:n[3]})}lastAnalyzedFen="";analyzePosition(t){if(!this.isInitialized||!this.stockfishWorker){console.warn("Stockfish not ready");return}const n=this.convertBanChessFEN(t);this.lastAnalyzedFen=n,this.stockfishWorker.postMessage("stop"),this.stockfishWorker.postMessage(`position fen ${n}`),this.stockfishWorker.postMessage(`go depth ${this.config.depth}`)}findBestMove(t,n){return new Promise((r,i)=>{if(!this.isInitialized||!this.stockfishWorker){i(new Error("Stockfish not ready"));return}const o=this.convertBanChessFEN(t),_=c=>{c.type==="bestMove"&&c.move&&(this.offEvent(_),r(c.move))};this.onEvent(_),this.stockfishWorker.postMessage("stop"),this.stockfishWorker.postMessage(`position fen ${o}`),this.stockfishWorker.postMessage(`go movetime ${n||this.config.timeLimit}`),setTimeout(()=>{this.offEvent(_),i(new Error("Best move search timeout"))},(n||this.config.timeLimit)+1e3)})}offEvent(t){const n=this.eventHandlers.indexOf(t);n>=0&&this.eventHandlers.splice(n,1)}stop(){this.stockfishWorker&&this.isInitialized&&this.stockfishWorker.postMessage("stop")}updateConfig(t){this.config={...this.config,...t},this.stockfishWorker&&this.isInitialized&&t.multiPV!==void 0&&this.stockfishWorker.postMessage(`setoption name MultiPV value ${t.multiPV}`)}onEvent(t){return this.eventHandlers.push(t),()=>{const n=this.eventHandlers.indexOf(t);n>=0&&this.eventHandlers.splice(n,1)}}emitEvent(t){this.eventHandlers.forEach(n=>{try{n(t)}catch(r){console.error("Engine event handler error:",r)}})}convertBanChessFEN(t){const n=t.split(" ");return n.length>6?n.slice(0,6).join(" "):t}dispose(){this.stop(),this.stockfishWorker&&(this.stockfishWorker.terminate(),this.stockfishWorker=null),this.isInitialized=!1,this.eventHandlers=[]}}const Zt="/ban-chess-gui/",Ne=["a","b","c","d","e","f","g","h"];function Ae(e,t=100){try{const n=new(window.AudioContext||window.webkitAudioContext),r=n.createOscillator(),i=n.createGain();r.connect(i),i.connect(n.destination),r.frequency.value=e,r.type="sine",i.gain.setValueAtTime(.3,n.currentTime),i.gain.exponentialRampToValueAtTime(.01,n.currentTime+t/1e3),r.start(n.currentTime),r.stop(n.currentTime+t/1e3)}catch{}}function Xt(){const[e]=Z(()=>new ue),[t,n]=Z([]),[r,i]=Z(null),[o,_]=Z([]),[c,s]=Z([]),[a,v]=Z(null),[l,S]=Z(!1),[d,A]=Z([]),[w,$]=Z(-1),[N,O]=Z(0),[U,Q]=Z(!1),[,re]=Z({}),[X]=Z(()=>new Yt({multiPV:3,depth:18,timeLimit:3e3})),[J]=Z({});Be(()=>{k(),X.initialize().catch(console.error);const h=X.onEvent(g=>{g.type==="evaluation"?(O(g.evaluation.score),Q(!1)):g.type==="bestMove"?Q(!1):g.type==="ready"&&(console.log("Stockfish engine is ready"),e.fen()&&X.analyzePosition(e.fen()))});return()=>{h(),X.dispose()}},[]),Be(()=>{const h=e.fen();h&&(Q(!0),X.analyzePosition(h))},[d,w]);const te=h=>{if(!h)return null;const g=h;if(J[g])return J[g];const T=h===h.toUpperCase(),B=h.toUpperCase(),L={K:"King",Q:"Queen",R:"Rook",B:"Bishop",N:"Knight",P:"Pawn"}[B];if(!L)return null;const K=`${Zt}themes/modern/${T?"white":"black"}/${L}.png`;return J[g]=K,K},k=()=>{const T=e.fen().split(" ")[0].split("/").map(B=>{const W=[];for(const L of B)if(isNaN(parseInt(L)))W.push(L);else for(let K=0;K<parseInt(L);K++)W.push(null);return W});n(T),_(e.legalMoves()),s(e.legalBans())},M=(h,g)=>{if(l){const T=h+1;return Ne[7-g]+T}else{const T=8-h;return Ne[g]+T}},R=h=>r?e.nextActionType()==="move"?o.some(g=>g.from===r&&g.to===h):c.some(g=>g.from===r&&g.to===h):!1,u=h=>e.nextActionType()==="move"?o.some(g=>g.from===h):c.some(g=>g.from===h),f=(h,g)=>{const T=M(h,g);if(Ae(600,50),!r){u(T)&&i(T);return}if(T===r){i(null);return}if(R(T)){const B=e.nextActionType()==="move"?{move:{from:r,to:T}}:{ban:{from:r,to:T}};p(B)}else u(T)&&i(T)},p=h=>{if(e.play(h).success){e.nextActionType()==="ban"?Ae(800,150):Ae(400,200);const T="move"in h?h.move.from:h.ban.from,B="move"in h?h.move.to:h.ban.to;A(W=>[...W,h]),$(d.length),v({from:T,to:B}),k(),i(null),re({}),e.gameOver()&&setTimeout(()=>{Ae(200,500)},200)}},m=(h,g)=>l?t[7-h]?.[7-g]:t[h]?.[g],y=h=>{const g=te(h);return g?b("img",{src:g,alt:h,style:{width:"90%",height:"90%",objectFit:"contain",userSelect:"none",pointerEvents:"none"},onError:T=>{console.warn("Failed to load piece image:",g),T.target.style.display="none"}}):null},P=h=>{e.reset();for(let g=0;g<=h;g++)d[g]&&e.play(d[g]);$(h),k(),re({})},E=h=>{O(h.evaluation.score)},C=()=>{Ae(1e3,100),e.reset(),A([]),$(-1),v(null),i(null),O(0),k(),re({})};return b("div",{className:"lichess-analysis-layout",children:[b("div",{className:"lichess-left-sidebar",children:b("div",{className:"lichess-eval-bar",children:[b("div",{className:"lichess-eval-bar-fill",style:{height:`${Math.max(0,Math.min(100,50+N/100*25))}%`,bottom:0}}),b("div",{className:`lichess-eval-score ${Math.abs(N)>200?N>0?"white-winning":"black-winning":""}`,children:Math.abs(N)>=2e3?N>0?"+M":"-M":N>=0?`+${(N/100).toFixed(1)}`:(N/100).toFixed(1)}),U&&b("div",{style:{position:"absolute",top:"4px",left:"50%",transform:"translateX(-50%)",width:"12px",height:"12px",border:"2px solid var(--lichess-border)",borderTop:"2px solid var(--lichess-primary)",borderRadius:"50%",animation:"lichess-spin 1s linear infinite"}})]})}),b("div",{className:"lichess-board-area",children:[b("div",{className:"lichess-board-wrapper",children:[b("div",{className:"lichess-board",children:[0,1,2,3,4,5,6,7].map(h=>[0,1,2,3,4,5,6,7].map(g=>{const T=M(h,g),B=m(h,g),W=T===r,L=r&&R(T),K=(h+g)%2===0,F=a&&(a.from===T||a.to===T),ee=e.currentBannedMove&&(e.currentBannedMove.from===T||e.currentBannedMove.to===T);return b("div",{onClick:()=>f(h,g),className:`lichess-square ${K?"light":"dark"} ${W?"selected":""} ${L?"legal-move":""} ${L&&B?"has-piece":""} ${F?"last-move":""}`,children:[B&&y(B),ee&&b("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",color:"#dc2626",fontSize:"24px",fontWeight:"bold",textShadow:"2px 2px 4px rgba(0,0,0,0.5)",pointerEvents:"none"},children:"×"})]},`${h}-${g}`)}))}),b("div",{style:{position:"absolute",left:"-20px",top:"0",height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-around",fontSize:"12px",color:"var(--lichess-text-secondary)"},children:Array.from({length:8},(h,g)=>b("div",{children:l?g+1:8-g},g))}),b("div",{style:{position:"absolute",bottom:"-20px",left:"0",right:"0",display:"flex",justifyContent:"space-around",fontSize:"12px",color:"var(--lichess-text-secondary)"},children:Array.from({length:8},(h,g)=>b("div",{children:l?Ne[7-g]:Ne[g]},g))})]}),b("div",{style:{marginTop:"24px",textAlign:"center"},children:[b("div",{style:{fontSize:"16px",marginBottom:"16px",color:"var(--lichess-text)"},children:e.gameOver()?b("div",{style:{color:"#ffeb3b",fontWeight:"600"},children:e.inCheckmate()?`Checkmate! ${e.turn==="white"?"Black":"White"} wins!`:"Draw!"}):b("div",{children:[b("span",{style:{color:e.turn==="white"?"#fff":"#aaa"},children:e.turn==="white"?"White":"Black"}),b("span",{style:{margin:"0 8px"},children:"to"}),b("span",{style:{color:e.nextActionType()==="ban"?"#e57373":"var(--lichess-accent)",fontWeight:"500"},children:e.nextActionType()==="ban"?"ban":"move"})]})}),b("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[b("button",{onClick:C,style:{padding:"10px 20px",background:"var(--lichess-primary)",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"New Game"}),b("button",{onClick:()=>S(!l),style:{padding:"10px 20px",background:"var(--lichess-panel-bg)",color:"var(--lichess-text)",border:"1px solid var(--lichess-border)",borderRadius:"4px",cursor:"pointer",fontSize:"14px"},children:"Flip Board"})]})]})]}),b(Vt,{fen:e.fen(),moveHistory:d,currentMoveIndex:w,engineManager:X,onMoveSelect:P,onLineSelect:E})]})}function Jt(){return b(Xt,{})}Wt(b(Jt,{}),document.getElementById("app"));
