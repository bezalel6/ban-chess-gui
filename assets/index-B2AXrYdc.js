(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const p of s.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&r(p)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var Be,D,mt,ve,Je,gt,yt,bt,He,We,De,Ee={},St=[],Rt=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,$e=Array.isArray;function fe(e,t){for(var n in t)e[n]=t[n];return e}function ze(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function Bt(e,t,n){var r,i,s,p={};for(s in t)s=="key"?r=t[s]:s=="ref"?i=t[s]:p[s]=t[s];if(arguments.length>2&&(p.children=arguments.length>3?Be.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(s in e.defaultProps)p[s]===void 0&&(p[s]=e.defaultProps[s]);return Ie(e,p,r,i,null)}function Ie(e,t,n,r,i){var s={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++mt,__i:-1,__u:0};return i==null&&D.vnode!=null&&D.vnode(s),s}function me(e){return e.children}function we(e,t){this.props=e,this.context=t}function ge(e,t){if(t==null)return e.__?ge(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?ge(e):null}function kt(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return kt(e)}}function et(e){(!e.__d&&(e.__d=!0)&&ve.push(e)&&!Me.__r++||Je!=D.debounceRendering)&&((Je=D.debounceRendering)||gt)(Me)}function Me(){for(var e,t,n,r,i,s,p,u=1;ve.length;)ve.length>u&&ve.sort(yt),e=ve.shift(),u=ve.length,e.__d&&(n=void 0,i=(r=(t=e).__v).__e,s=[],p=[],t.__P&&((n=fe({},r)).__v=r.__v+1,D.vnode&&D.vnode(n),je(t.__P,n,r,t.__n,t.__P.namespaceURI,32&r.__u?[i]:null,s,i??ge(r),!!(32&r.__u),p),n.__v=r.__v,n.__.__k[n.__i]=n,Pt(s,n,p),n.__e!=i&&kt(n)));Me.__r=0}function At(e,t,n,r,i,s,p,u,o,l,v){var a,S,d,E,O,K,N,B=r&&r.__k||St,x=t.length;for(o=$t(n,t,B,o,x),a=0;a<x;a++)(d=n.__k[a])!=null&&(S=d.__i==-1?Ee:B[d.__i]||Ee,d.__i=a,K=je(e,d,S,i,s,p,u,o,l,v),E=d.__e,d.ref&&S.ref!=d.ref&&(S.ref&&Ge(S.ref,null,d),v.push(d.ref,d.__c||E,d)),O==null&&E!=null&&(O=E),(N=!!(4&d.__u))||S.__k===d.__k?o=Et(d,o,e,N):typeof d.type=="function"&&K!==void 0?o=K:E&&(o=E.nextSibling),d.__u&=-7);return n.__e=O,o}function $t(e,t,n,r,i){var s,p,u,o,l,v=n.length,a=v,S=0;for(e.__k=new Array(i),s=0;s<i;s++)(p=t[s])!=null&&typeof p!="boolean"&&typeof p!="function"?(o=s+S,(p=e.__k[s]=typeof p=="string"||typeof p=="number"||typeof p=="bigint"||p.constructor==String?Ie(null,p,null,null,null):$e(p)?Ie(me,{children:p},null,null,null):p.constructor==null&&p.__b>0?Ie(p.type,p.props,p.key,p.ref?p.ref:null,p.__v):p).__=e,p.__b=e.__b+1,u=null,(l=p.__i=Lt(p,n,o,a))!=-1&&(a--,(u=n[l])&&(u.__u|=2)),u==null||u.__v==null?(l==-1&&(i>v?S--:i<v&&S++),typeof p.type!="function"&&(p.__u|=4)):l!=o&&(l==o-1?S--:l==o+1?S++:(l>o?S--:S++,p.__u|=4))):e.__k[s]=null;if(a)for(s=0;s<v;s++)(u=n[s])!=null&&(2&u.__u)==0&&(u.__e==r&&(r=ge(u)),Ct(u,u));return r}function Et(e,t,n,r){var i,s;if(typeof e.type=="function"){for(i=e.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=e,t=Et(i[s],t,n,r));return t}e.__e!=t&&(r&&(t&&e.type&&!t.parentNode&&(t=ge(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function Lt(e,t,n,r){var i,s,p,u=e.key,o=e.type,l=t[n],v=l!=null&&(2&l.__u)==0;if(l===null&&e.key==null||v&&u==l.key&&o==l.type)return n;if(r>(v?1:0)){for(i=n-1,s=n+1;i>=0||s<t.length;)if((l=t[p=i>=0?i--:s++])!=null&&(2&l.__u)==0&&u==l.key&&o==l.type)return p}return-1}function tt(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||Rt.test(t)?n:n+"px"}function Ce(e,t,n,r,i){var s,p;e:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof r=="string"&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||tt(e.style,t,"");if(n)for(t in n)r&&n[t]==r[t]||tt(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")s=t!=(t=t.replace(bt,"$1")),p=t.toLowerCase(),t=p in e||t=="onFocusOut"||t=="onFocusIn"?p.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+s]=n,n?r?n.u=r.u:(n.u=He,e.addEventListener(t,s?De:We,s)):e.removeEventListener(t,s?De:We,s);else{if(i=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function nt(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=He++;else if(t.t<n.u)return;return n(D.event?D.event(t):t)}}}function je(e,t,n,r,i,s,p,u,o,l){var v,a,S,d,E,O,K,N,B,x,Q,re,X,J,te,k,w,R=t.type;if(t.constructor!=null)return null;128&n.__u&&(o=!!(32&n.__u),s=[u=t.__e=n.__e]),(v=D.__b)&&v(t);e:if(typeof R=="function")try{if(N=t.props,B="prototype"in R&&R.prototype.render,x=(v=R.contextType)&&r[v.__c],Q=v?x?x.props.value:v.__:r,n.__c?K=(a=t.__c=n.__c).__=a.__E:(B?t.__c=a=new R(N,Q):(t.__c=a=new we(N,Q),a.constructor=R,a.render=Ut),x&&x.sub(a),a.props=N,a.state||(a.state={}),a.context=Q,a.__n=r,S=a.__d=!0,a.__h=[],a._sb=[]),B&&a.__s==null&&(a.__s=a.state),B&&R.getDerivedStateFromProps!=null&&(a.__s==a.state&&(a.__s=fe({},a.__s)),fe(a.__s,R.getDerivedStateFromProps(N,a.__s))),d=a.props,E=a.state,a.__v=t,S)B&&R.getDerivedStateFromProps==null&&a.componentWillMount!=null&&a.componentWillMount(),B&&a.componentDidMount!=null&&a.__h.push(a.componentDidMount);else{if(B&&R.getDerivedStateFromProps==null&&N!==d&&a.componentWillReceiveProps!=null&&a.componentWillReceiveProps(N,Q),!a.__e&&a.shouldComponentUpdate!=null&&a.shouldComponentUpdate(N,a.__s,Q)===!1||t.__v==n.__v){for(t.__v!=n.__v&&(a.props=N,a.state=a.__s,a.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(c){c&&(c.__=t)}),re=0;re<a._sb.length;re++)a.__h.push(a._sb[re]);a._sb=[],a.__h.length&&p.push(a);break e}a.componentWillUpdate!=null&&a.componentWillUpdate(N,a.__s,Q),B&&a.componentDidUpdate!=null&&a.__h.push(function(){a.componentDidUpdate(d,E,O)})}if(a.context=Q,a.props=N,a.__P=e,a.__e=!1,X=D.__r,J=0,B){for(a.state=a.__s,a.__d=!1,X&&X(t),v=a.render(a.props,a.state,a.context),te=0;te<a._sb.length;te++)a.__h.push(a._sb[te]);a._sb=[]}else do a.__d=!1,X&&X(t),v=a.render(a.props,a.state,a.context),a.state=a.__s;while(a.__d&&++J<25);a.state=a.__s,a.getChildContext!=null&&(r=fe(fe({},r),a.getChildContext())),B&&!S&&a.getSnapshotBeforeUpdate!=null&&(O=a.getSnapshotBeforeUpdate(d,E)),k=v,v!=null&&v.type===me&&v.key==null&&(k=Tt(v.props.children)),u=At(e,$e(k)?k:[k],t,n,r,i,s,p,u,o,l),a.base=t.__e,t.__u&=-161,a.__h.length&&p.push(a),K&&(a.__E=a.__=null)}catch(c){if(t.__v=null,o||s!=null)if(c.then){for(t.__u|=o?160:128;u&&u.nodeType==8&&u.nextSibling;)u=u.nextSibling;s[s.indexOf(u)]=null,t.__e=u}else{for(w=s.length;w--;)ze(s[w]);qe(t)}else t.__e=n.__e,t.__k=n.__k,c.then||qe(t);D.__e(c,t,n)}else s==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):u=t.__e=Kt(n.__e,t,n,r,i,s,p,o,l);return(v=D.diffed)&&v(t),128&t.__u?void 0:u}function qe(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(qe)}function Pt(e,t,n){for(var r=0;r<n.length;r++)Ge(n[r],n[++r],n[++r]);D.__c&&D.__c(t,e),e.some(function(i){try{e=i.__h,i.__h=[],e.some(function(s){s.call(i)})}catch(s){D.__e(s,i.__v)}})}function Tt(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:$e(e)?e.map(Tt):fe({},e)}function Kt(e,t,n,r,i,s,p,u,o){var l,v,a,S,d,E,O,K=n.props,N=t.props,B=t.type;if(B=="svg"?i="http://www.w3.org/2000/svg":B=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),s!=null){for(l=0;l<s.length;l++)if((d=s[l])&&"setAttribute"in d==!!B&&(B?d.localName==B:d.nodeType==3)){e=d,s[l]=null;break}}if(e==null){if(B==null)return document.createTextNode(N);e=document.createElementNS(i,B,N.is&&N),u&&(D.__m&&D.__m(t,s),u=!1),s=null}if(B==null)K===N||u&&e.data==N||(e.data=N);else{if(s=s&&Be.call(e.childNodes),K=n.props||Ee,!u&&s!=null)for(K={},l=0;l<e.attributes.length;l++)K[(d=e.attributes[l]).name]=d.value;for(l in K)if(d=K[l],l!="children"){if(l=="dangerouslySetInnerHTML")a=d;else if(!(l in N)){if(l=="value"&&"defaultValue"in N||l=="checked"&&"defaultChecked"in N)continue;Ce(e,l,null,d,i)}}for(l in N)d=N[l],l=="children"?S=d:l=="dangerouslySetInnerHTML"?v=d:l=="value"?E=d:l=="checked"?O=d:u&&typeof d!="function"||K[l]===d||Ce(e,l,d,K[l],i);if(v)u||a&&(v.__html==a.__html||v.__html==e.innerHTML)||(e.innerHTML=v.__html),t.__k=[];else if(a&&(e.innerHTML=""),At(t.type=="template"?e.content:e,$e(S)?S:[S],t,n,r,B=="foreignObject"?"http://www.w3.org/1999/xhtml":i,s,p,s?s[0]:n.__k&&ge(n,0),u,o),s!=null)for(l=s.length;l--;)ze(s[l]);u||(l="value",B=="progress"&&E==null?e.removeAttribute("value"):E!=null&&(E!==e[l]||B=="progress"&&!E||B=="option"&&E!=K[l])&&Ce(e,l,E,K[l],i),l="checked",O!=null&&O!=e[l]&&Ce(e,l,O,K[l],i))}return e}function Ge(e,t,n){try{if(typeof e=="function"){var r=typeof e.__u=="function";r&&e.__u(),r&&t==null||(e.__u=e(t))}else e.current=t}catch(i){D.__e(i,n)}}function Ct(e,t,n){var r,i;if(D.unmount&&D.unmount(e),(r=e.ref)&&(r.current&&r.current!=e.__e||Ge(r,null,t)),(r=e.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(s){D.__e(s,t)}r.base=r.__P=null}if(r=e.__k)for(i=0;i<r.length;i++)r[i]&&Ct(r[i],t,n||typeof e.type!="function");n||ze(e.__e),e.__c=e.__=e.__e=void 0}function Ut(e,t,n){return this.constructor(e,n)}function Ft(e,t,n){var r,i,s,p;t==document&&(t=document.documentElement),D.__&&D.__(e,t),i=(r=!1)?null:t.__k,s=[],p=[],je(t,e=t.__k=Bt(me,null,[e]),i||Ee,Ee,t.namespaceURI,i?null:t.firstChild?Be.call(t.childNodes):null,s,i?i.__e:t.firstChild,r,p),Pt(s,e,p)}Be=St.slice,D={__e:function(e,t,n,r){for(var i,s,p;t=t.__;)if((i=t.__c)&&!i.__)try{if((s=i.constructor)&&s.getDerivedStateFromError!=null&&(i.setState(s.getDerivedStateFromError(e)),p=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(e,r||{}),p=i.__d),p)return i.__E=i}catch(u){e=u}throw e}},mt=0,we.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=fe({},this.state),typeof e=="function"&&(e=e(fe({},n),this.props)),e&&fe(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),et(this))},we.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),et(this))},we.prototype.render=me,ve=[],gt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,yt=function(e,t){return e.__v.__b-t.__v.__b},Me.__r=0,bt=/(PointerCapture)$|Capture$/i,He=0,We=nt(!1),De=nt(!0);var Wt=0;function b(e,t,n,r,i,s){t||(t={});var p,u,o=t;if("ref"in o)for(u in o={},t)u=="ref"?p=t[u]:o[u]=t[u];var l={type:e,props:o,key:n,ref:p,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Wt,__i:-1,__u:0,__source:i,__self:s};if(typeof e=="function"&&(p=e.defaultProps))for(u in p)o[u]===void 0&&(o[u]=p[u]);return D.vnode&&D.vnode(l),l}var Pe,z,Ke,rt,xe=0,Nt=[],G=D,it=G.__b,ot=G.__r,st=G.diffed,at=G.__c,lt=G.unmount,ct=G.__;function Ve(e,t){G.__h&&G.__h(z,e,xe||t),xe=0;var n=z.__H||(z.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function Z(e){return xe=1,Dt(wt,e)}function Dt(e,t,n){var r=Ve(Pe++,2);if(r.t=e,!r.__c&&(r.__=[wt(void 0,t),function(u){var o=r.__N?r.__N[0]:r.__[0],l=r.t(o,u);o!==l&&(r.__N=[l,r.__[1]],r.__c.setState({}))}],r.__c=z,!z.__f)){var i=function(u,o,l){if(!r.__c.__H)return!0;var v=r.__c.__H.__.filter(function(S){return!!S.__c});if(v.every(function(S){return!S.__N}))return!s||s.call(this,u,o,l);var a=r.__c.props!==u;return v.forEach(function(S){if(S.__N){var d=S.__[0];S.__=S.__N,S.__N=void 0,d!==S.__[0]&&(a=!0)}}),s&&s.call(this,u,o,l)||a};z.__f=!0;var s=z.shouldComponentUpdate,p=z.componentWillUpdate;z.componentWillUpdate=function(u,o,l){if(this.__e){var v=s;s=void 0,i(u,o,l),s=v}p&&p.call(this,u,o,l)},z.shouldComponentUpdate=i}return r.__N||r.__}function Re(e,t){var n=Ve(Pe++,3);!G.__s&&It(n.__H,t)&&(n.__=e,n.u=t,z.__H.__h.push(n))}function qt(e,t){var n=Ve(Pe++,7);return It(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function xt(){for(var e;e=Nt.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(Oe),e.__H.__h.forEach(Qe),e.__H.__h=[]}catch(t){e.__H.__h=[],G.__e(t,e.__v)}}G.__b=function(e){z=null,it&&it(e)},G.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),ct&&ct(e,t)},G.__r=function(e){ot&&ot(e),Pe=0;var t=(z=e.__c).__H;t&&(Ke===z?(t.__h=[],z.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(Oe),t.__h.forEach(Qe),t.__h=[],Pe=0)),Ke=z},G.diffed=function(e){st&&st(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(Nt.push(t)!==1&&rt===G.requestAnimationFrame||((rt=G.requestAnimationFrame)||Qt)(xt)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Ke=z=null},G.__c=function(e,t){t.some(function(n){try{n.__h.forEach(Oe),n.__h=n.__h.filter(function(r){return!r.__||Qe(r)})}catch(r){t.some(function(i){i.__h&&(i.__h=[])}),t=[],G.__e(r,n.__v)}}),at&&at(e,t)},G.unmount=function(e){lt&&lt(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{Oe(r)}catch(i){t=i}}),n.__H=void 0,t&&G.__e(t,n.__v))};var ut=typeof requestAnimationFrame=="function";function Qt(e){var t,n=function(){clearTimeout(r),ut&&cancelAnimationFrame(t),setTimeout(e)},r=setTimeout(n,35);ut&&(t=requestAnimationFrame(n))}function Oe(e){var t=z,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),z=t}function Qe(e){var t=z;e.__c=e.__(),z=t}function It(e,t){return!e||e.length!==t.length||t.some(function(n,r){return n!==e[r]})}function wt(e,t){return typeof t=="function"?t(e):t}var Ue={},ce={},I={},Fe={},ft;function Te(){return ft||(ft=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ROOKS=e.SQUARES=e.RANKS=e.RANK_8=e.RANK_7=e.RANK_6=e.RANK_5=e.RANK_4=e.RANK_3=e.RANK_2=e.RANK_1=e.BITS=e.FLAGS=e.SHIFTS=e.RAYS=e.ATTACKS=e.PIECE_OFFSETS=e.PAWN_OFFSETS=e.POSSIBLE_RESULTS=e.DEFAULT_POSITION=e.SYMBOLS=e.EMPTY=e.KING=e.QUEEN=e.ROOK=e.BISHOP=e.KNIGHT=e.PAWN=e.BLACK=e.WHITE=void 0,e.WHITE="w",e.BLACK="b",e.PAWN="p",e.KNIGHT="n",e.BISHOP="b",e.ROOK="r",e.QUEEN="q",e.KING="k",e.EMPTY=-1,e.SYMBOLS="pnbrqkPNBRQK",e.DEFAULT_POSITION="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",e.POSSIBLE_RESULTS=["1-0","0-1","1/2-1/2","*"],e.PAWN_OFFSETS={b:[16,32,17,15],w:[-16,-32,-17,-15]},e.PIECE_OFFSETS={p:[],n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},e.ATTACKS=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],e.RAYS=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],e.SHIFTS={p:0,n:1,b:2,r:3,q:4,k:5},e.FLAGS={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},e.BITS={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},e.RANK_1=7,e.RANK_2=6,e.RANK_3=5,e.RANK_4=4,e.RANK_5=3,e.RANK_6=2,e.RANK_7=1,e.RANK_8=0,e.RANKS=[e.RANK_8,e.RANK_7,e.RANK_6,e.RANK_5,e.RANK_4,e.RANK_3,e.RANK_2,e.RANK_1],e.SQUARES={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},e.ROOKS={w:[{square:e.SQUARES.a1,flag:e.BITS.QSIDE_CASTLE},{square:e.SQUARES.h1,flag:e.BITS.KSIDE_CASTLE}],b:[{square:e.SQUARES.a8,flag:e.BITS.QSIDE_CASTLE},{square:e.SQUARES.h8,flag:e.BITS.KSIDE_CASTLE}]}})(Fe)),Fe}var ke={},ht;function Ye(){if(ht)return ke;ht=1,Object.defineProperty(ke,"__esModule",{value:!0}),ke.State=void 0;var e=Te(),t=Ot(),n=(function(){function r(i,s,p,u,o,l,v){this.board=i||new Array(128),this.kings=s||{w:e.EMPTY,b:e.EMPTY},this.turn=p||e.WHITE,this.castling=u||{w:0,b:0},this.ep_square=o||e.EMPTY,this.half_moves=l||0,this.move_number=v||1}return r.prototype.clone=function(){return new r(this.board.slice(),{w:this.kings.w,b:this.kings.b},this.turn,{w:this.castling.w,b:this.castling.b},this.ep_square,this.half_moves,this.move_number)},Object.defineProperty(r.prototype,"fen",{get:function(){return t.getFen(this)},enumerable:!1,configurable:!0}),r})();return ke.State=n,ke}var W={},_t;function Ze(){if(_t)return W;_t=1,Object.defineProperty(W,"__esModule",{value:!0}),W.strippedSan=W.validateFen=W.isFlagKey=W.isSquare=W.isPieceSymbol=W.isColor=W.symbol=W.isDigit=W.swapColor=W.algebraic=W.file=W.rank=void 0;var e=Te();function t(d){return d>>4}W.rank=t;function n(d){return d&15}W.file=n;function r(d){var E=n(d),O=t(d);return"abcdefgh".substring(E,E+1)+"87654321".substring(O,O+1)}W.algebraic=r;function i(d){return d===e.WHITE?e.BLACK:e.WHITE}W.swapColor=i;function s(d){return/^[0-9]$/.test(d)}W.isDigit=s;function p(d){var E=d.type,O=d.color;return O===e.WHITE?E.toUpperCase():E.toLowerCase()}W.symbol=p;function u(d){return d==="w"||d==="b"}W.isColor=u;function o(d){return/^[pnbrqk]$/.test(d)}W.isPieceSymbol=o;function l(d){return/^[a-h][1-8]$/.test(d)}W.isSquare=l;function v(d){var E=["NORMAL","CAPTURE","BIG_PAWN","EP_CAPTURE","PROMOTION","KSIDE_CASTLE","QSIDE_CASTLE"];return E.indexOf(d)!==-1}W.isFlagKey=v;function a(d){var E={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"Illegal en-passant square"},O=d.split(/\s+/);if(O.length!==6)return{valid:!1,error_number:1,error:E[1]};if(isNaN(O[5])||parseInt(O[5],10)<=0)return{valid:!1,error_number:2,error:E[2]};if(isNaN(O[4])||parseInt(O[4],10)<0)return{valid:!1,error_number:3,error:E[3]};if(!/^(-|[abcdefgh][36])$/.test(O[3]))return{valid:!1,error_number:4,error:E[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(O[2]))return{valid:!1,error_number:5,error:E[5]};if(!/^(w|b)$/.test(O[1]))return{valid:!1,error_number:6,error:E[6]};var K=O[0].split("/");if(K.length!==8)return{valid:!1,error_number:7,error:E[7]};for(var N=0;N<K.length;N++){for(var B=0,x=!1,Q=0;Q<K[N].length;Q++)if(isNaN(K[N][Q])){if(!/^[prnbqkPRNBQK]$/.test(K[N][Q]))return{valid:!1,error_number:9,error:E[9]};B+=1,x=!1}else{if(x)return{valid:!1,error_number:8,error:E[8]};B+=parseInt(K[N][Q],10),x=!0}if(B!==8)return{valid:!1,error_number:10,error:E[10]}}return O[3][1]=="3"&&O[1]=="w"||O[3][1]=="6"&&O[1]=="b"?{valid:!1,error_number:11,error:E[11]}:{valid:!0,error_number:0,error:E[0]}}W.validateFen=a;function S(d){return d.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}return W.strippedSan=S,W}var dt;function Ot(){if(dt)return I;dt=1,Object.defineProperty(I,"__esModule",{value:!0}),I.validateMove=I.getBoard=I.ascii=I.buildMove=I.makeMove=I.insufficientMaterial=I.inStalemate=I.inCheckmate=I.inCheck=I.isKingAttacked=I.isAttacked=I.makePretty=I.sanToMove=I.moveToSan=I.generateMoves=I.removePiece=I.putPiece=I.clonePiece=I.cloneMove=I.getPiece=I.loadPgn=I.getPgn=I.loadFen=I.getFen=I.getDisambiguator=void 0;var e=Te(),t=Ye(),n=Ze();function r(c,f,_){for(var m=d(c,{legal:!_}),y=f.from,P=f.to,A=f.piece,T=0,h=0,g=0,C=0,M=m.length;C<M;C++){var F=m[C].from,$=m[C].to,L=m[C].piece;A===L&&y!==F&&P===$&&(T++,n.rank(y)===n.rank(F)&&h++,n.file(y)===n.file(F)&&g++)}return T>0?h>0&&g>0?n.algebraic(y):g>0?n.algebraic(y).charAt(1):n.algebraic(y).charAt(0):""}I.getDisambiguator=r;function i(c){for(var f=0,_="",m=e.SQUARES.a8;m<=e.SQUARES.h1;m++){var y=c.board[m];if(!y)f++;else{f>0&&(_+=f,f=0);var P=y.color,A=y.type;_+=P===e.WHITE?A.toUpperCase():A.toLowerCase()}m+1&136&&(f>0&&(_+=f),m!==e.SQUARES.h1&&(_+="/"),f=0,m+=8)}var T="";c.castling[e.WHITE]&e.BITS.KSIDE_CASTLE&&(T+="K"),c.castling[e.WHITE]&e.BITS.QSIDE_CASTLE&&(T+="Q"),c.castling[e.BLACK]&e.BITS.KSIDE_CASTLE&&(T+="k"),c.castling[e.BLACK]&e.BITS.QSIDE_CASTLE&&(T+="q"),T=T||"-";var h=c.ep_square===e.EMPTY?"-":n.algebraic(c.ep_square);return[_,c.turn,T,h,c.half_moves,c.move_number].join(" ")}I.getFen=i;function s(c){var f=c.split(/\s+/),_=f[0],m=0;if(!n.validateFen(c).valid)return null;for(var y=new t.State,P=0;P<_.length;P++){var A=_.charAt(P);if(A==="/")m+=8;else if(n.isDigit(A))m+=parseInt(A,10);else{var T=A<"a"?e.WHITE:e.BLACK,h=a(y,{type:A.toLowerCase(),color:T},n.algebraic(m));if(!h)return null;y=h,m++}}return y.turn=f[1]===e.BLACK?e.BLACK:e.WHITE,f[2].indexOf("K")>-1&&(y.castling.w|=e.BITS.KSIDE_CASTLE),f[2].indexOf("Q")>-1&&(y.castling.w|=e.BITS.QSIDE_CASTLE),f[2].indexOf("k")>-1&&(y.castling.b|=e.BITS.KSIDE_CASTLE),f[2].indexOf("q")>-1&&(y.castling.b|=e.BITS.QSIDE_CASTLE),y.ep_square=f[3]==="-"?e.EMPTY:e.SQUARES[f[3]],y.half_moves=parseInt(f[4],10),y.move_number=parseInt(f[5],10),y}I.loadFen=s;function p(c,f,_,m,y){y===void 0&&(y={});var P=y.newline_char,A=P===void 0?`
`:P,T=y.max_width,h=T===void 0?0:T,g=[],C=!1;for(var M in f)g.push("["+M+' "'+f[M]+'"]'+A),C=!0;C&&m.length&&g.push(A);var F=function(j){var V=_[c.fen];if(typeof V<"u"){var Y=j.length>0?" ":"";j=""+j+Y+"{"+V+"}"}return j};m[0]&&(c=m[0].state);var $=[],L="";if(m.length===0&&$.push(F("")),m.forEach(function(j,V){var Y=j.move;L=F(L),V===0&&Y.color===e.BLACK?L=c.move_number+". ...":Y.color===e.WHITE&&(L.length&&$.push(L),L=c.move_number+"."),L=L+" "+E(c,Y),c=J(c,Y)}),L.length&&$.push(F(L)),typeof f.Result<"u"&&$.push(f.Result),h===0)return g.join("")+$.join(" ");for(var U=function(){return g.length>0&&g[g.length-1]===" "?(g.pop(),!0):!1},ee=function(j,V){for(var Y=0,le=V.split(" ");Y<le.length;Y++){var ie=le[Y];if(ie){if(j+ie.length>h){for(;U();)j--;g.push(A),j=0}g.push(ie),j+=ie.length,g.push(" "),j++}}return U()&&j--,j},H=0,M=0;M<$.length;M++){if(H+$[M].length>h&&$[M].includes("{")){H=ee(H,$[M]);continue}H+$[M].length>h&&M!==0?(g[g.length-1]===" "&&g.pop(),g.push(A),H=0):M!==0&&(g.push(" "),H++),g.push($[M]),H+=$[M].length}return g.join("")}I.getPgn=p;function u(c,f){f===void 0&&(f={});var _=f.newline_char,m=_===void 0?`\r?
`:_,y=f.sloppy,P=y===void 0?!1:y,A=function(q){return q.replace(/\\/g,"\\")},T=function(q,ne){for(var ye=ne.newline_char,be={},_e=q.split(new RegExp(A(ye))),he="",Se="",de=0;de<_e.length;de++)he=_e[de].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),Se=_e[de].replace(/^\[[A-Za-z]+\s"(.*)" *\]$/,"$1"),he.trim().length>0&&(be[he.trim()]=Se);return be},h=new RegExp("^(\\[((?:"+A(m)+")|.)*\\])(?:"+A(m)+"){2}"),g=h.test(c)?h.exec(c)[1]:"",C=s(e.DEFAULT_POSITION),M=T(g,{newline_char:m});if(M.SetUp==="1"&&"FEN"in M){var F=s(M.FEN);if(!F)return null;C=F}for(var $=function(q){return Array.from(q).map(function(ne){return ne.charCodeAt(0)<128?ne.charCodeAt(0).toString(16):encodeURIComponent(ne).replace(/%/g,"").toLowerCase()}).join("")},L=function(q){var ne;return q.length==0?"":decodeURIComponent("%"+((ne=q?.match(/.{1,2}/g))===null||ne===void 0?void 0:ne.join("%")))},U=function(q){return q=q.replace(new RegExp(A(m),"g")," "),"{"+$(q.slice(1,q.length-1))+"}"},ee=function(q){if(q.startsWith("{")&&q.endsWith("}"))return L(q.slice(1,q.length-1))},H=c.replace(g,"").replace(new RegExp("({[^}]*})+?|;([^"+A(m)+"]*)","g"),function(q,ne,ye){return ne!==void 0?U(ne):" "+U("{"+ye.slice(1)+"}")}).replace(new RegExp(A(m),"g")," "),j=/(\([^()]+\))+?/g;j.test(H);)H=H.replace(j,"");H=H.replace(/\d+\.(\.\.)?/g,""),H=H.replace(/\.\.\./g,""),H=H.replace(/\$\d+/g,"");for(var V=H.trim().split(new RegExp(/\s+/)).join(",").replace(/,,+/g,",").split(","),Y={},le=[],ie=0;ie<V.length;ie++){var se=V[ie],oe=ee(se);if(oe!==void 0){Y[C.fen]=oe;continue}if(ie===V.length-1&&e.POSSIBLE_RESULTS.indexOf(se)!==-1){Object.keys(M).length&&typeof M.Result>"u"&&(M.Result=se);continue}var ae=O(C,V[ie],{sloppy:P});if(ae===null)return null;le.push({move:ae,state:C});var F=J(C,ae);if(!F)return null;C=F}return[C,M,Y,le]}I.loadPgn=u;function o(c,f){if(!f||(f=f.toLowerCase(),!n.isSquare(f)))return null;var _=e.SQUARES[f],m=c.board[_];return m?v(m):null}I.getPiece=o;function l(c){return{to:c.to,from:c.from,color:c.color,flags:c.flags,piece:c.piece,captured:c.captured,promotion:c.promotion,san:c.san}}I.cloneMove=l;function v(c){return{color:c.color,type:c.type}}I.clonePiece=v;function a(c,f,_){var m=f.type,y=f.color;if(!m||!y||!_||(m=m.toLowerCase(),y=y.toLowerCase(),_=_.toLowerCase(),!n.isPieceSymbol(m)||!n.isColor(y)||!n.isSquare(_)))return null;var P=c.clone(),A=e.SQUARES[_];return m===e.KING&&P.kings[y]!==e.EMPTY&&P.kings[y]!==A?null:(P.board[A]={type:m,color:y},m===e.KING&&(P.kings[y]=A),P)}I.putPiece=a;function S(c,f){if(!f||(f=f.toLowerCase(),!n.isSquare(f)))return null;var _=e.SQUARES[f],m=c.board[_];if(!m)return null;var y=c.clone(),P=m.type,A=m.color;return P===e.KING&&(y.kings[A]=e.EMPTY),delete y.board[_],y}I.removePiece=S;function d(c,f){var _,m;f===void 0&&(f={});var y=f.legal,P=y===void 0?!0:y,A=function(ye,be,_e,he,Se){var de=ye[_e];if(de&&de.type===e.PAWN&&(n.rank(he)===e.RANK_8||n.rank(he)===e.RANK_1))for(var Xe=[e.QUEEN,e.ROOK,e.BISHOP,e.KNIGHT],Le=0,Mt=Xe.length;Le<Mt;Le++)be.push(te(c,_e,he,Se,Xe[Le]));else be.push(te(c,_e,he,Se))},T=[],h=c.turn,g=n.swapColor(h),C={b:e.RANK_7,w:e.RANK_2},M=e.SQUARES.a8,F=e.SQUARES.h1,$=!1,L=f.square;if(L)if(L=L.toLowerCase(),n.isSquare(L))M=F=e.SQUARES[L],$=!0;else return[];for(var U=M;U<=F;U++){if(U&136){U+=7;continue}var ee=c.board[U];if(!(!ee||ee.color!==h))if(ee.type===e.PAWN){var H=U+e.PAWN_OFFSETS[h][0];if(!c.board[H]){A(c.board,T,U,H,e.BITS.NORMAL);var j=U+e.PAWN_OFFSETS[h][1];C[h]===n.rank(U)&&!c.board[j]&&A(c.board,T,U,j,e.BITS.BIG_PAWN)}for(var V=2;V<4;V++){var Y=U+e.PAWN_OFFSETS[h][V];Y&136||(c.board[Y]&&((_=c.board[Y])===null||_===void 0?void 0:_.color)===g?A(c.board,T,U,Y,e.BITS.CAPTURE):Y===c.ep_square&&A(c.board,T,U,c.ep_square,e.BITS.EP_CAPTURE))}}else for(var V=0,le=e.PIECE_OFFSETS[ee.type].length;V<le;V++)for(var ie=e.PIECE_OFFSETS[ee.type][V],se=U;se+=ie,!(se&136);){if(!c.board[se])A(c.board,T,U,se,e.BITS.NORMAL);else{if(((m=c.board[se])===null||m===void 0?void 0:m.color)===h)break;A(c.board,T,U,se,e.BITS.CAPTURE);break}if(ee.type==="n"||ee.type==="k")break}}if(!$||F===c.kings[h]){if(c.castling[h]&e.BITS.KSIDE_CASTLE){var oe=c.kings[h],ae=oe+2;!c.board[oe+1]&&!c.board[ae]&&!N(c,g,c.kings[h])&&!N(c,g,oe+1)&&!N(c,g,ae)&&A(c.board,T,c.kings[h],ae,e.BITS.KSIDE_CASTLE)}if(c.castling[h]&e.BITS.QSIDE_CASTLE){var oe=c.kings[h],ae=oe-2;!c.board[oe-1]&&!c.board[oe-2]&&!c.board[oe-3]&&!N(c,g,c.kings[h])&&!N(c,g,oe-1)&&!N(c,g,ae)&&A(c.board,T,c.kings[h],ae,e.BITS.QSIDE_CASTLE)}}if(!P)return T;for(var q=[],U=0,le=T.length;U<le;U++){var ne=J(c,T[U]);B(ne,h)||q.push(T[U])}return q}I.generateMoves=d;function E(c,f,_){var m;_===void 0&&(_={});var y=_.sloppy,P=y===void 0?!1:y,A=_.checkPromotion,T=A===void 0?!0:A,h="";if(f.flags&e.BITS.KSIDE_CASTLE)h="O-O";else if(f.flags&e.BITS.QSIDE_CASTLE)h="O-O-O";else{var g=r(c,f,P);f.piece!==e.PAWN&&(h+=f.piece.toUpperCase()+g),f.flags&(e.BITS.CAPTURE|e.BITS.EP_CAPTURE)&&(f.piece===e.PAWN&&(h+=n.algebraic(f.from)[0]),h+="x"),h+=n.algebraic(f.to),T&&f.flags&e.BITS.PROMOTION&&(h+="="+((m=f.promotion)===null||m===void 0?void 0:m.toUpperCase()))}var C=J(c,f);return x(C)&&(Q(C)?h+="#":h+="+"),h}I.moveToSan=E;function O(c,f,_){_===void 0&&(_={});var m=_.sloppy,y=m===void 0?!1:m,P=_.checkPromotion,A=P===void 0?!0:P,T=n.strippedSan(f),h,g,C,M,F;y&&(h=T.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),h&&(g=h[1],C=h[2],M=h[3],F=h[4]));for(var $=d(c,{square:C}),L=0,U=$.length;L<U;L++){var ee=E(c,$[L],{checkPromotion:A});if(T===n.strippedSan(ee)||y&&T===n.strippedSan(E(c,$[L],_))||C&&M&&n.isSquare(C)&&n.isSquare(M)&&h&&(!g||g.toLowerCase()==$[L].piece)&&e.SQUARES[C]==$[L].from&&e.SQUARES[M]==$[L].to&&(!A||!F||F.toLowerCase()==$[L].promotion))return $[L]}return null}I.sanToMove=O;function K(c,f){var _=l(f),m="";for(var y in e.BITS)n.isFlagKey(y)&&e.BITS[y]&_.flags&&(m+=e.FLAGS[y]);return{to:n.algebraic(_.to),from:n.algebraic(_.from),color:_.color,flags:m,piece:_.piece,san:E(c,_),captured:_.captured,promotion:_.promotion}}I.makePretty=K;function N(c,f,_){for(var m,y=e.SQUARES.a8;y<=e.SQUARES.h1;y++){if(y&136){y+=7;continue}if(!(c.board[y]==null||((m=c.board[y])===null||m===void 0?void 0:m.color)!==f)){var P=c.board[y],A=y-_,T=A+119;if(P&&e.ATTACKS[T]&1<<e.SHIFTS[P.type]){if(P.type===e.PAWN){if(A>0){if(P.color===e.WHITE)return!0}else if(P.color===e.BLACK)return!0;continue}if(P.type==="n"||P.type==="k")return!0;for(var h=e.RAYS[T],g=y+h,C=!1;g!==_;){if(c.board[g]){C=!0;break}g+=h}if(!C)return!0}}}return!1}I.isAttacked=N;function B(c,f){return N(c,n.swapColor(f),c.kings[f])}I.isKingAttacked=B;function x(c){return B(c,c.turn)}I.inCheck=x;function Q(c){return x(c)&&d(c).length===0}I.inCheckmate=Q;function re(c){return!x(c)&&d(c).length===0}I.inStalemate=re;function X(c){for(var f={},_=[],m=0,y=0,P=e.SQUARES.a8;P<=e.SQUARES.h1;P++){if(y=(y+1)%2,P&136){P+=7;continue}var A=c.board[P];A&&(f[A.type]=A.type in f?f[A.type]+1:1,A.type===e.BISHOP&&_.push(y),m++)}if(m===2)return!0;if(m===3&&(f[e.BISHOP]===1||f[e.KNIGHT]===1))return!0;if(m===f[e.BISHOP]+2){for(var T=0,h=_.length,P=0;P<h;P++)T+=_[P];if(T===0||T===h)return!0}return!1}I.insufficientMaterial=X;function J(c,f){var _=c.clone(),m=_.turn,y=n.swapColor(m);_.board[f.to]=_.board[f.from],delete _.board[f.from],f.flags&e.BITS.EP_CAPTURE&&(_.turn===e.BLACK?delete _.board[f.to-16]:delete _.board[f.to+16]),f.flags&e.BITS.PROMOTION&&f.promotion&&n.isPieceSymbol(f.promotion)&&(_.board[f.to]={type:f.promotion,color:m});var P=_.board[f.to];if(P&&P.type===e.KING){if(_.kings[P.color]=f.to,f.flags&e.BITS.KSIDE_CASTLE){var A=f.to-1,T=f.to+1;_.board[A]=_.board[T],delete _.board[T]}else if(f.flags&e.BITS.QSIDE_CASTLE){var A=f.to+1,T=f.to-2;_.board[A]=_.board[T],delete _.board[T]}_.castling[m]=0}if(_.castling[m]){for(var h=0,g=e.ROOKS[m].length;h<g;h++)if(f.from===e.ROOKS[m][h].square&&_.castling[m]&e.ROOKS[m][h].flag){_.castling[m]^=e.ROOKS[m][h].flag;break}}if(_.castling[y]){for(var h=0,g=e.ROOKS[y].length;h<g;h++)if(f.to===e.ROOKS[y][h].square&&_.castling[y]&e.ROOKS[y][h].flag){_.castling[y]^=e.ROOKS[y][h].flag;break}}return f.flags&e.BITS.BIG_PAWN?_.turn==="b"?_.ep_square=f.to-16:_.ep_square=f.to+16:_.ep_square=e.EMPTY,f.piece===e.PAWN||f.flags&(e.BITS.CAPTURE|e.BITS.EP_CAPTURE)?_.half_moves=0:_.half_moves++,_.turn===e.BLACK&&_.move_number++,_.turn=n.swapColor(_.turn),_}I.makeMove=J;function te(c,f,_,m,y){var P,A={color:c.turn,from:f,to:_,flags:m,piece:c.board[f].type};return y&&n.isPieceSymbol(y)&&(A.flags|=e.BITS.PROMOTION,A.promotion=y),c.board[_]?A.captured=(P=c.board[_])===null||P===void 0?void 0:P.type:m&e.BITS.EP_CAPTURE&&(A.captured=e.PAWN),A}I.buildMove=te;function k(c,f){f===void 0&&(f=`
`);var _=e.RANKS.map(function(m){for(var y=c.slice(m*16,m*16+8),P=[],A=0,T=y;A<T.length;A++){var h=T[A];P.push(h?" "+n.symbol(h)+" ":" . ")}var g=P.join("");return"87654321"[m]+" |"+g+"|"});return["  +------------------------+",_.join(f),"  +------------------------+","    a  b  c  d  e  f  g  h"].join(f)}I.ascii=k;function w(c){for(var f=[],_=[],m=e.SQUARES.a8;m<=e.SQUARES.h1;m++){var y=c[m];y==null?_.push(null):_.push({type:y.type,color:y.color}),m+1&136&&(f.push(_),_=[],m+=8)}return f}I.getBoard=w;function R(c,f,_){_===void 0&&(_={});var m=_.checkPromotion,y=m===void 0?!0:m;if(typeof f=="string")return O(c,f,_);if(typeof f=="object")for(var P=d(c,{square:f.from}),A=0,T=P;A<T.length;A++){var h=T[A];if(f.from===n.algebraic(h.from)&&f.to===n.algebraic(h.to)&&(!y||!("promotion"in h)||f.promotion===h.promotion))return h}return null}return I.validateMove=R,I}var pt;function Ht(){if(pt)return ce;pt=1;var e=ce&&ce.__assign||function(){return e=Object.assign||function(u){for(var o,l=1,v=arguments.length;l<v;l++){o=arguments[l];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(u[a]=o[a])}return u},e.apply(this,arguments)},t=ce&&ce.__spreadArrays||function(){for(var u=0,o=0,l=arguments.length;o<l;o++)u+=arguments[o].length;for(var v=Array(u),a=0,o=0;o<l;o++)for(var S=arguments[o],d=0,E=S.length;d<E;d++,a++)v[a]=S[d];return v};Object.defineProperty(ce,"__esModule",{value:!0}),ce.Chess=void 0;var n=Ot(),r=Ye(),i=Ze(),s=Te(),p=(function(){function u(o){if(o===void 0&&(o=s.DEFAULT_POSITION),this._state=new r.State,this._history=[],this._header={},this._comments={},!this.load(o))throw new Error("Error loading fen")}return Object.defineProperty(u.prototype,"state",{get:function(){return this._state.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"states",{get:function(){return t(this._history.map(function(o){return o.state.clone()}),[this.state])},enumerable:!1,configurable:!0}),u.prototype.load=function(o,l){l===void 0&&(l=!1);var v=n.loadFen(o);return v?(this._state=v,this._history=[],l||(this._header={}),this._comments={},this.updateSetup(),!0):!1},u.prototype.clear=function(o){o===void 0&&(o=!1),this._state=new r.State,this._history=[],o||(this._header={}),this._comments={},this.updateSetup()},u.prototype.reset=function(){this.load(s.DEFAULT_POSITION)},u.prototype.get=function(o){return n.getPiece(this._state,o)},u.prototype.put=function(o,l){var v=n.putPiece(this._state,o,l);return v?(this._state=v,this.updateSetup(),!0):!1},u.prototype.remove=function(o){var l=n.getPiece(this._state,o);if(!l)return null;var v=n.removePiece(this._state,o);return v?(this._state=v,l):null},u.prototype.moves=function(o){var l=this;o===void 0&&(o={});var v=o.square,a=o.verbose,S=a===void 0?!1:a,d=n.generateMoves(this._state,{square:v});return S?d.map(function(E){return n.makePretty(l._state,E)}):d.map(function(E){return n.moveToSan(l._state,E)})},u.prototype.fen=function(){return this._state.fen},u.prototype.inCheck=function(){return n.inCheck(this._state)},u.prototype.inCheckmate=function(){return n.inCheckmate(this._state)},u.prototype.inStalemate=function(){return n.inStalemate(this._state)},u.prototype.insufficientMaterial=function(){return n.insufficientMaterial(this._state)},u.prototype.inThreefoldRepetition=function(){for(var o={},l=function(d){var E=d.fen.split(" ").slice(0,4).join(" ");return o[E]=E in o?o[E]+1:1,o[E]>=3},v=0,a=this._history;v<a.length;v++){var S=a[v].state;if(l(S))return!0}return l(this._state)},u.prototype.inDraw=function(){return this._state.half_moves>=100||this.inStalemate()||this.insufficientMaterial()||this.inThreefoldRepetition()},u.prototype.gameOver=function(){return this.inCheckmate()||this.inDraw()},u.prototype.board=function(){return n.getBoard(this._state.board)},u.prototype.pgn=function(o){return o===void 0&&(o={}),n.getPgn(this._state,this._header,this._comments,this._history,o)},u.prototype.loadPgn=function(o,l){l===void 0&&(l={});var v=n.loadPgn(o,l);if(!v)return!1;var a=v[0],S=v[1],d=v[2],E=v[3];return this._state=a,this._header=S,this._comments=d,this._history=E,!0},u.prototype.header=function(){return this._header},u.prototype.setHeader=function(o){this._header=o},u.prototype.addHeader=function(o,l){this._header[o]=l},u.prototype.removeHeader=function(o){delete this._header[o]},u.prototype.clearHeader=function(){this._header={}},u.prototype.ascii=function(o){return o===void 0&&(o=`
`),n.ascii(this._state.board,o)},u.prototype.turn=function(){return this._state.turn},u.prototype.move=function(o,l){l===void 0&&(l={});var v=n.validateMove(this._state,o,l);if(!v)return null;var a=n.makePretty(this._state,v);return l.dry_run||this.makeMove(v),a},u.prototype.validateMoves=function(o,l){l===void 0&&(l={});for(var v=[],a=this._state,S=0,d=o;S<d.length;S++){var E=d[S],O=n.validateMove(a,E,l);if(!O)return null;v.push(n.makePretty(a,O)),a=n.makeMove(a,O)}return v},u.prototype.isPromotion=function(o,l){l===void 0&&(l={});var v=n.validateMove(this._state,o,e(e({},l),{checkPromotion:!1}));return v?!!(v.flags&s.BITS.PROMOTION):!1},u.prototype.undo=function(){var o=this.undoMove();return o?n.makePretty(this._state,o):null},u.prototype.squareColor=function(o){if(i.isSquare(o)){var l=s.SQUARES[o];return(i.rank(l)+i.file(l))%2===0?"light":"dark"}return null},u.prototype.history=function(o){o===void 0&&(o={});var l=o.verbose,v=l===void 0?!1:l;if(!this._history.length)return[];var a;return v?this._history.map(function(S){var d=S.move;return a=S.state,n.makePretty(a,d)}):this._history.map(function(S){var d=S.move;return a=S.state,n.moveToSan(a,d)})},u.prototype.getComment=function(o){return o=o||this.fen(),this._comments[o]},u.prototype.getComments=function(){var o=this;return this.pruneComments(),Object.keys(this._comments).map(function(l){return{fen:l,comment:o._comments[l]}})},u.prototype.setComment=function(o,l){l=l||this.fen(),this._comments[l]=o.replace("{","[").replace("}","]")},u.prototype.deleteComment=function(o){o=o||this.fen();var l=this._comments[o];return delete this._comments[o],l},u.prototype.deleteComments=function(){var o=this;return this.pruneComments(),Object.keys(this._comments).map(function(l){var v=o._comments[l];return delete o._comments[l],{fen:l,comment:v}})},u.prototype.validateFen=function(o){return i.validateFen(o)},u.prototype.clone=function(){var o=new u;return o._state=this._state,o._history=t(this._history),o._header=e({},this._header),o._comments=e({},this._comments),o},u.prototype.perft=function(o){for(var l=n.generateMoves(this._state,{legal:!1}),v=0,a=this._state.turn,S=0,d=l.length;S<d;S++){if(this.makeMove(l[S]),!this.kingAttacked(a))if(o-1>0){var E=this.perft(o-1);v+=E}else v++;this.undoMove()}return v},u.prototype.updateSetup=function(){var o=this._state.fen;this._history.length>0||(o!==s.DEFAULT_POSITION?(this._header.SetUp="1",this._header.FEN=o):(delete this._header.SetUp,delete this._header.FEN))},u.prototype.pruneComments=function(){var o=this,l={},v=function(S){S in o._comments&&(l[S]=o._comments[S])};this._history.forEach(function(S){var d=S.state;a=d,v(a.fen)});var a=this._state;v(a.fen),this._comments=l},u.prototype.strippedSan=function(o){return o.replace(/=/,"").replace(/[+#]?[?!]*$/,"")},u.prototype.attacked=function(o,l){return n.isAttacked(this._state,o,l)},u.prototype.kingAttacked=function(o){return this.attacked(i.swapColor(o),this._state.kings[o])},u.prototype.makeMove=function(o){this._history.push({move:o,state:this._state}),this._state=n.makeMove(this._state,o)},u.prototype.undoMove=function(){var o=this._history.pop();return o==null?null:(this._state=o.state,o.move)},u})();return ce.Chess=p,ce}var vt;function zt(){return vt||(vt=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Ht();Object.defineProperty(e,"Chess",{enumerable:!0,get:function(){return t.Chess}});var n=Ye();Object.defineProperty(e,"State",{enumerable:!0,get:function(){return n.State}});var r=Te();Object.defineProperty(e,"WHITE",{enumerable:!0,get:function(){return r.WHITE}}),Object.defineProperty(e,"BLACK",{enumerable:!0,get:function(){return r.BLACK}}),Object.defineProperty(e,"PAWN",{enumerable:!0,get:function(){return r.PAWN}}),Object.defineProperty(e,"KNIGHT",{enumerable:!0,get:function(){return r.KNIGHT}}),Object.defineProperty(e,"BISHOP",{enumerable:!0,get:function(){return r.BISHOP}}),Object.defineProperty(e,"ROOK",{enumerable:!0,get:function(){return r.ROOK}}),Object.defineProperty(e,"QUEEN",{enumerable:!0,get:function(){return r.QUEEN}}),Object.defineProperty(e,"KING",{enumerable:!0,get:function(){return r.KING}}),Object.defineProperty(e,"EMPTY",{enumerable:!0,get:function(){return r.EMPTY}}),Object.defineProperty(e,"SQUARES",{enumerable:!0,get:function(){return r.SQUARES}}),Object.defineProperty(e,"FLAGS",{enumerable:!0,get:function(){return r.FLAGS}}),Object.defineProperty(e,"BITS",{enumerable:!0,get:function(){return r.BITS}});var i=Ze();Object.defineProperty(e,"rank",{enumerable:!0,get:function(){return i.rank}}),Object.defineProperty(e,"file",{enumerable:!0,get:function(){return i.file}}),Object.defineProperty(e,"algebraic",{enumerable:!0,get:function(){return i.algebraic}})})(Ue)),Ue}var pe=zt();const jt="3.1.1";class ue{constructor(t,n){this._currentBannedMove=null,this._history=[],this._ply=1,this._indicatorConfig={pgn:!0,serialization:!0,san:!0},this.chess=new pe.Chess,n?this.loadFromPGN(n):t&&this.loadFromFEN(t)}getPly(){return this._ply}getActivePlayer(){switch((this._ply-1)%4+1){case 1:return"black";case 2:return"white";case 3:return"white";case 4:return"black";default:return"black"}}getActionType(){return this._ply%2===1?"ban":"move"}get turn(){return this.getActivePlayer()}get currentBannedMove(){return this._currentBannedMove}nextActionType(){return this.getActionType()}play(t){try{return"ban"in t?this.playBan(t.ban):this.playMove(t.move)}catch(n){return{success:!1,error:n instanceof Error?n.message:"Unknown error"}}}playBan(t){if(this.gameOver())return{success:!1,error:"Game is over"};if(this.getActionType()!=="ban")return{success:!1,error:"Expected a move, not a ban"};if(!this.legalBans().some(d=>d.from===t.from&&d.to===t.to))return{success:!1,error:`Invalid ban: ${t.from}-${t.to}`};this._currentBannedMove=t;const i=new pe.Chess(this.chess.fen()),p=i.moves({verbose:!0}).filter(d=>!(d.from===t.from&&d.to===t.to)),u=p.length===0&&i.inCheck(),o=p.length===0&&!i.inCheck(),l=i.inCheck()&&p.length>0,v={check:l,checkmate:u,stalemate:o,gameOver:u||o,banCausedCheckmate:u,banCausedStalemate:o};let a=`${t.from}${t.to}`;this._indicatorConfig.san&&(u?a+="#":o?a+="=":l&&(a+="+"));const S={ply:this._ply,player:this.getActivePlayer(),actionType:"ban",action:t,fen:this.fen(),bannedMove:t,san:a,flags:v};return this._history.push(S),this._ply++,{success:!0,action:{ban:t},san:this._indicatorConfig.san?a:`${t.from}${t.to}`,newFen:this.fen(),flags:v,check:v.check,checkmate:v.checkmate,stalemate:v.stalemate,gameOver:v.gameOver,draw:v.draw}}playMove(t){if(this.gameOver())return{success:!1,error:"Game is over"};if(this.getActionType()!=="move")return{success:!1,error:"Expected a ban, not a move"};if(this.isBannedMove(t))return{success:!1,error:`Move ${t.from}-${t.to} is banned`};const n=this.chess.move({from:t.from,to:t.to,promotion:t.promotion});if(!n)return{success:!1,error:`Invalid move: ${t.from}-${t.to}`};const r={check:this.chess.inCheck(),checkmate:this.chess.inCheckmate(),stalemate:this.chess.inStalemate(),draw:this.chess.inDraw(),gameOver:this.chess.gameOver(),insufficientMaterial:this.chess.insufficientMaterial(),threefoldRepetition:this.chess.inThreefoldRepetition(),fiftyMoveRule:this.chess.inDraw()&&!this.chess.inStalemate()&&!this.chess.insufficientMaterial()},i={ply:this._ply,player:this.getActivePlayer(),actionType:"move",action:t,san:n.san,fen:this.fen(),bannedMove:this._currentBannedMove,flags:r};this._history.push(i),this._currentBannedMove=null,this._ply++;let s=n.san;return!this._indicatorConfig.san&&s&&(s=s.replace(/[+#=]$/,"")),{success:!0,action:{move:t},san:s,newFen:this.fen(),flags:r,check:r.check,checkmate:r.checkmate,stalemate:r.stalemate,gameOver:r.gameOver,draw:r.draw}}isBannedMove(t){return this._currentBannedMove?this._currentBannedMove.from===t.from&&this._currentBannedMove.to===t.to:!1}getLegalActions(){return this.gameOver()?[]:this.getActionType()==="ban"?this.legalBans().map(t=>({ban:t})):this.legalMoves().map(t=>({move:t}))}legalMoves(){if(this.gameOver())return[];if(this.getActionType()!=="move")return[];const n=this.chess.moves({verbose:!0}).map(r=>({from:r.from,to:r.to,promotion:r.promotion}));return this._currentBannedMove?n.filter(r=>!this.isBannedMove(r)):n}legalBans(){if(this.gameOver())return[];if(this.getActionType()!=="ban")return[];const n=new pe.Chess(this.chess.fen()).moves({verbose:!0}),r=new Map;return n.forEach(i=>{const s=`${i.from}-${i.to}`;r.has(s)||r.set(s,{from:i.from,to:i.to})}),Array.from(r.values())}inCheck(){return this.chess.inCheck()}inCheckmate(){return this.chess.inCheckmate()}inStalemate(){return this.chess.inStalemate()}gameOver(){return this.inCheckmate()||this.inStalemate()||this.inDraw()}inDraw(){return this.chess.inDraw()}inThreefoldRepetition(){return this.chess.inThreefoldRepetition()}insufficientMaterial(){return this.chess.insufficientMaterial()}currentPlayer(){return this.turn}setIndicatorConfig(t){this._indicatorConfig={...this._indicatorConfig,...t}}getIndicatorConfig(){return{...this._indicatorConfig}}nextMoveColor(){return this.chess.turn()==="w"?"white":"black"}getGameIndicator(){const t=this.getGameFlags();return t.checkmate?"#":t.stalemate||t.draw?"=":t.check?"+":""}getGameFlags(){const t=this._history[this._history.length-1],n=t?.flags?.banCausedCheckmate||!1,r=t?.flags?.banCausedStalemate||!1;return{check:this.chess.inCheck(),checkmate:this.chess.inCheckmate(),stalemate:this.chess.inStalemate(),draw:this.chess.inDraw(),gameOver:this.chess.gameOver(),insufficientMaterial:this.chess.insufficientMaterial(),threefoldRepetition:this.chess.inThreefoldRepetition(),fiftyMoveRule:this.chess.inDraw()&&!this.chess.inStalemate()&&!this.chess.insufficientMaterial()&&!this.chess.inThreefoldRepetition(),banCausedCheckmate:n,banCausedStalemate:r}}fen(){const t=this.chess.fen();let n=this._ply.toString();this._currentBannedMove&&(n+=`:${this._currentBannedMove.from}${this._currentBannedMove.to}`);const r=this.getGameIndicator();return n+=r,`${t} ${n}`}pgn(){let t="",n="";for(let r=0;r<this._history.length;r++){const i=this._history[r];let s=1;if(i.actionType==="move"&&(i.player==="white"?s=Math.floor((i.ply-2)/4)+1:s=Math.floor((i.ply-4)/4)+1),i.actionType==="ban"){const p=i.action;let u=`${p.from}${p.to}`;if(this._indicatorConfig.pgn&&i.san){const o=i.san.match(/[+#=]$/)?.[0];o&&(u+=o)}n+=`{banning: ${u}} `}else{i.player==="white"&&(n=`${s}. ${n}`);let p=i.san||"";!this._indicatorConfig.pgn&&p&&(p=p.replace(/[+#=]$/,"")),n+=`${p} `,i.player==="black"&&(t+=n,n="")}}if(n){const r=this._history.length>0?Math.floor((this._history[this._history.length-1].ply+1)/2):1;n.startsWith(`${r}.`)||(n=`${r}. ${n}`),t+=n}if(this._history.length>0){const r=this._history[this._history.length-1];if(r.actionType==="move"&&r.san){if(r.san.endsWith("#")){const i=r.player==="white"?"1-0":"0-1";t=t.trim()+" "+i}}else if(r.actionType==="ban"&&this.gameOver())if(this.inCheckmate()){const i=this.chess.turn()==="w"?"0-1":"1-0";t=t.trim()+" "+i}else this.inStalemate()&&(t=t.trim()+" 1/2-1/2")}return t.trim()}history(){return[...this._history]}reset(){this.chess=new pe.Chess,this._currentBannedMove=null,this._history=[],this._ply=1}ascii(){let t=this.chess.ascii();return this._currentBannedMove&&(t+=`
Banned: ${this._currentBannedMove.from}-${this._currentBannedMove.to}`),t+=`
Ply: ${this._ply} (${this.getActionType()} by ${this.getActivePlayer()})`,t}static serializeAction(t,n){let r;if("ban"in t)r=`b:${t.ban.from}${t.ban.to}`;else{const i=t.move;r=`m:${i.from}${i.to}${i.promotion||""}`}return n&&(r+=n),r}static deserializeAction(t){const n=t.match(/^([bm]):([a-h][1-8])([a-h][1-8])([qrbn])?([+#=])?$/);if(!n)throw new Error(`Invalid serialized action format: ${t}`);const[,r,i,s,p,u]=n;return r==="b"?{ban:{from:i,to:s}}:{move:p?{from:i,to:s,promotion:p}:{from:i,to:s}}}getLastActionSerialized(){if(this._history.length===0)return null;const t=this._history[this._history.length-1],n=t.actionType==="ban"?{ban:t.action}:{move:t.action};if(!this._indicatorConfig.serialization)return ue.serializeAction(n);let r;if(t.san){const i=t.san.match(/[+#=]$/);i&&(r=i[0])}return ue.serializeAction(n,r)}getSyncState(){return{fen:this.fen(),lastAction:this.getLastActionSerialized()||void 0,ply:this._ply}}playSerializedAction(t){try{const n=ue.deserializeAction(t);return this.play(n)}catch(n){return{success:!1,error:n instanceof Error?n.message:"Invalid serialized action"}}}loadFromSyncState(t){this.loadFromFEN(t.fen),this._ply=t.ply}getActionLog(){return this._history.map(t=>{if(t.actionType==="ban"){const n=t.action;let r=`b:${n.from}${n.to}`;if(t.san&&this._indicatorConfig.serialization){const i=t.san.match(/[+#=]$/);i&&(r+=i[0])}return r}else return t.san||`${t.action.from}${t.action.to}`})}getActionHistory(){return this._history.map((t,n)=>{const r=t.actionType==="ban"?{ban:t.action}:{move:t.action};if(!this._indicatorConfig.serialization)return ue.serializeAction(r);let i;return t.actionType==="move"?t.san?.endsWith("#")?i="#":t.san?.endsWith("+")&&(i="+"):n===this._history.length-1&&(this.gameOver()?this.inCheckmate()?i="#":this.inStalemate()&&(i="="):this.nextActionType()==="move"&&this.chess.inCheck()&&(i="+")),ue.serializeAction(r,i)})}static replayFromActions(t,n){const r=new ue(n);for(const i of t){const s=r.playSerializedAction(i);if(!s.success)throw new Error(`Failed to replay action ${i}: ${s.error}`)}return r}loadFromFEN(t){const n=t.split(" ");if(n.length<7){this.chess=new pe.Chess(t);return}const r=n.slice(0,6).join(" ");let i=n[6];if(this.chess=new pe.Chess(r),i&&i!=="-"){const s=i[i.length-1];if((s==="+"||s==="#"||s==="=")&&(i=i.slice(0,-1)),i.includes(":")){const[p,u]=i.split(":");this._ply=parseInt(p,10)||1,u&&u.length>=4&&(this._currentBannedMove={from:u.substring(0,2),to:u.substring(2,4)})}else{const p=parseInt(i,10);if(!isNaN(p))this._ply=p;else if(i.startsWith("b:")||i.startsWith("w:")){const[u,o]=i.split(":");o!=="ban"&&o.length===4&&(this._currentBannedMove={from:o.substring(0,2),to:o.substring(2,4)})}}}}loadFromPGN(t){this.reset();const n=t.match(/\{banning:\s*[a-h][1-8][a-h][1-8]\}|[KQRBN]?[a-h]?[1-8]?x?[a-h][1-8](?:=[QRBN])?[+#]?|\d+\./g);if(n){for(const r of n)if(!/^\d+\.$/.test(r)){if(r.includes("banning:")){const i=r.match(/([a-h][1-8])([a-h][1-8])/);if(i){const s={from:i[1],to:i[2]};this.play({ban:s})}}else if(/^[KQRBN]?[a-h]?[1-8]?x?[a-h][1-8]/.test(r)){const s=this.legalMoves().find(p=>{const o=new pe.Chess(this.chess.fen()).move({from:p.from,to:p.to,promotion:p.promotion});return o&&o.san===r});s&&this.play({move:s})}}}}}ue.VERSION=jt;const Gt=[{id:"computer",name:"Computer",icon:"🤖"},{id:"opening",name:"Opening",icon:"📚"},{id:"settings",name:"Settings",icon:"⚙️"}];function Vt({fen:e,moveHistory:t,currentMoveIndex:n,engineManager:r,onMoveSelect:i,onLineSelect:s}){const[p,u]=Z("computer"),[o,l]=Z([]),[v,a]=Z("1"),[S,d]=Z({multiPV:3,depth:18,enabled:!0}),[E,O]=Z(null),K={e4:{name:"King's Pawn",eco:"B00"},"e4 e5":{name:"King's Pawn Game",eco:"C20"},"e4 e5 Nf3":{name:"King's Knight Opening",eco:"C20"},"e4 e5 Nf3 Nc6":{name:"King's Knight Opening",eco:"C20"},"e4 e5 Nf3 Nc6 Bb5":{name:"Ruy Lopez",eco:"C60"},"e4 e5 Nf3 Nc6 Bc4":{name:"Italian Game",eco:"C50"},"e4 e5 Nf3 f5":{name:"Latvian Gambit",eco:"C40"},"e4 c5":{name:"Sicilian Defense",eco:"B20"},"e4 c6":{name:"Caro-Kann Defense",eco:"B10"},"e4 e6":{name:"French Defense",eco:"C00"},d4:{name:"Queen's Pawn",eco:"D00"},"d4 d5":{name:"Queen's Pawn Game",eco:"D00"},"d4 d5 c4":{name:"Queen's Gambit",eco:"D06"},"d4 Nf6":{name:"Indian Defense",eco:"A40"},"d4 Nf6 c4":{name:"Queen's Indian Setup",eco:"A47"},"d4 f5":{name:"Dutch Defense",eco:"A80"},Nf3:{name:"Réti Opening",eco:"A04"},c4:{name:"English Opening",eco:"A10"},f4:{name:"Bird's Opening",eco:"A02"},b3:{name:"Nimzo-Larsen Attack",eco:"A01"},g3:{name:"King's Indian Attack",eco:"A07"},Nc3:{name:"Van't Kruijs Opening",eco:"A00"}};Re(()=>r.onEvent(w=>{switch(w.type){case"evaluation":l(R=>{const c=`stockfish-${w.multiPV}`,f=R.findIndex(m=>m.id===c),_={id:c,evaluation:w.evaluation,multipv:w.multiPV,isSelected:v===c};if(f>=0){const m=[...R];return m[f]=_,m}else return[...R,_].sort((m,y)=>m.multipv-y.multipv)});break;case"error":console.error("Stockfish error:",w.error);break}}),[r,v]),Re(()=>{if(S.enabled&&e&&r.analyzePosition(e),t.length<=10){const k=t.map(R=>x(R)).join(" ");let w=K[k];if(!w&&k.includes(" ")){const R=k.split(" ");for(let c=R.length-1;c>0;c--){const f=R.slice(0,c).join(" ");if(K[f]){w=K[f];break}}}w?O({name:w.name,eco:w.eco,moves:k||"Starting position"}):t.length===0?O({name:"Starting Position",eco:"",moves:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq -"}):O(null)}else O(null)},[e,S.enabled,r,t]);const N=(k,w)=>{if(w!==void 0)return{text:`M${Math.abs(w)}`,className:"mate"};const R=k/100;return Math.abs(R)>=10?{text:R>0?"+−":"−+",className:R>0?"positive":"negative"}:{text:R>=0?`+${R.toFixed(1)}`:R.toFixed(1),className:R>0?"positive":"negative"}},B=k=>{if("move"in k){const{from:w,to:R,promotion:c}=k.move;return c?`${w}${R}=${c.toUpperCase()}`:`${w}${R}`}else{const{from:w,to:R}=k.ban;return`${w}${R}×`}},x=k=>{if("move"in k){const{from:w,to:R,promotion:c}=k.move,f=w[0]===w[0].toLowerCase()?"":w[0].toUpperCase();return c?`${f}${R}=${c.toUpperCase()}`:`${f}${R}`}else{const{from:w,to:R}=k.ban;return`${w}-${R}×`}},Q=k=>k.slice(0,6).join(" "),re=qt(()=>{const k=[];for(let w=0;w<t.length;w+=2)k.push({number:Math.floor(w/2)+1,white:t[w],black:t[w+1],whiteIndex:w,blackIndex:w+1});return k},[t]),X=k=>{a(k.id),s?.(k)},J=k=>{i?.(k)},te=k=>{const w={...S,...k};d(w),r.updateConfig({multiPV:w.multiPV,depth:w.depth})};return b("div",{className:"lichess-right-panel",children:[b("div",{className:"lichess-panel-tabs",children:Gt.map(k=>b("div",{className:`lichess-tab ${p===k.id?"active":""}`,onClick:()=>u(k.id),children:[b("span",{children:k.icon}),b("span",{children:k.name})]},k.id))}),b("div",{className:"lichess-analysis-content",children:[p==="computer"&&b(me,{children:[b("div",{className:"lichess-engine-lines",children:[o.length===0&&b("div",{className:"lichess-loading",children:"Analyzing position..."}),o.map(k=>{const w=N(k.evaluation.score,k.evaluation.mate);return b("div",{className:`lichess-engine-line ${k.isSelected?"selected":""}`,"data-multipv":k.multipv,onClick:()=>X(k),children:[b("div",{className:`lichess-line-eval ${w.className}`,children:w.text}),b("div",{className:"lichess-line-moves",children:[Q(k.evaluation.pv),k.evaluation.depth&&b("span",{style:{marginLeft:"8px",fontSize:"10px",color:"var(--lichess-text-secondary)"},children:["d",k.evaluation.depth]})]})]},k.id)})]}),b("div",{className:"lichess-eval-graph",children:b("div",{className:"lichess-eval-curve"})}),b("div",{className:"lichess-move-list",children:[re.length===0&&b("div",{className:"lichess-loading",children:"No moves yet"}),re.map(k=>b("div",{className:"lichess-move-pair",children:[b("div",{className:"lichess-move-number",children:[k.number,"."]}),k.white&&b("div",{className:`lichess-move white-move ${n===k.whiteIndex?"current":""} ${"ban"in k.white?"ban-move":""}`,onClick:()=>J(k.whiteIndex),title:`${B(k.white)} (${k.whiteIndex+1})`,children:x(k.white)}),k.black&&b("div",{className:`lichess-move black-move ${n===k.blackIndex?"current":""} ${"ban"in k.black?"ban-move":""}`,onClick:()=>J(k.blackIndex),title:`${B(k.black)} (${k.blackIndex+1})`,children:x(k.black)})]},k.number))]})]}),p==="opening"&&b("div",{className:"lichess-opening",children:E?b(me,{children:[b("div",{className:"lichess-opening-name",children:E.name}),E.eco&&b("div",{className:"lichess-opening-eco",children:E.eco}),b("div",{className:"lichess-opening-moves",children:t.length>0?b(me,{children:[b("strong",{children:"Moves:"})," ",E.moves]}):b("em",{children:"Starting position - make your first move!"})}),t.length<10&&b("div",{style:{marginTop:"12px",fontSize:"11px",color:"var(--lichess-text-secondary)",fontStyle:"italic"},children:"Opening information shown for first 10 moves"})]}):b("div",{className:"lichess-loading",children:t.length>10?"Opening phase complete - now in the middle game":"Unknown opening or position"})}),p==="settings"&&b("div",{className:"lichess-engine-settings",children:[b("div",{className:"lichess-settings-section",children:[b("h4",{style:{color:"var(--lichess-text)",marginBottom:"12px",fontSize:"13px"},children:"Engine Configuration"}),b("div",{className:"lichess-setting-row",children:[b("span",{className:"lichess-setting-label",children:[b("strong",{children:"Computer Analysis"}),b("div",{style:{fontSize:"10px",color:"var(--lichess-text-secondary)"},children:"Enable real-time position evaluation"})]}),b("label",{className:"lichess-toggle",children:[b("input",{type:"checkbox",checked:S.enabled,onChange:k=>te({enabled:k.target.checked})}),b("span",{className:"lichess-toggle-slider"})]})]}),b("div",{className:"lichess-setting-row",children:[b("span",{className:"lichess-setting-label",children:[b("strong",{children:"Multiple Lines"}),b("div",{style:{fontSize:"10px",color:"var(--lichess-text-secondary)"},children:"Show top engine variations"})]}),b("div",{className:"lichess-slider-container",children:[b("input",{type:"range",min:"1",max:"5",value:S.multiPV,onChange:k=>te({multiPV:parseInt(k.target.value)}),className:"lichess-slider",disabled:!S.enabled}),b("span",{className:"lichess-setting-value",children:S.multiPV})]})]}),b("div",{className:"lichess-setting-row",children:[b("span",{className:"lichess-setting-label",children:[b("strong",{children:"Search Depth"}),b("div",{style:{fontSize:"10px",color:"var(--lichess-text-secondary)"},children:"Maximum calculation depth"})]}),b("div",{className:"lichess-slider-container",children:[b("input",{type:"range",min:"5",max:"25",value:S.depth,onChange:k=>te({depth:parseInt(k.target.value)}),className:"lichess-slider",disabled:!S.enabled}),b("span",{className:"lichess-setting-value",children:S.depth})]})]})]}),b("div",{className:"lichess-settings-section",style:{marginTop:"20px"},children:[b("h4",{style:{color:"var(--lichess-text)",marginBottom:"8px",fontSize:"13px"},children:"Engine Status"}),b("div",{style:{fontSize:"11px",color:"var(--lichess-text-secondary)"},children:[b("div",{children:"🔥 Stockfish.js (WASM)"}),b("div",{style:{color:"var(--lichess-text-tertiary)",fontSize:"10px"},children:"World's strongest chess engine"}),b("div",{style:{marginTop:"8px"},children:["Analysis: ",S.enabled?"✅ Active":"⏸️ Paused"]})]})]})]})]})]})}class Yt{stockfishWorker=null;eventHandlers=[];config;isInitialized=!1;constructor(t){this.config={...t}}async initialize(){this.isInitialized||(await this.initializeStockfish(),this.isInitialized=!0)}async initializeStockfish(){return new Promise((t,n)=>{try{this.stockfishWorker=new Worker(new URL("/ban-chess-gui/assets/StockfishWorker-C0PKYsb9.js",import.meta.url),{type:"module"}),this.stockfishWorker.onmessage=i=>{this.handleStockfishMessage(i.data)},this.stockfishWorker.postMessage({type:"INIT",payload:{multiPV:this.config.multiPV,depth:this.config.depth,timeLimit:this.config.timeLimit}});const r=i=>{i.data.type==="READY"?(this.stockfishWorker.removeEventListener("message",r),this.emit({type:"ready"}),t()):i.data.type==="ERROR"&&n(new Error(i.data.error))};this.stockfishWorker.addEventListener("message",r),setTimeout(()=>n(new Error("Stockfish initialization timeout")),1e4)}catch(r){n(r)}})}handleStockfishMessage(t){switch(t.type){case"ANALYSIS":this.emit({type:"evaluation",evaluation:t.evaluation,multiPV:t.multiPV});break;case"BEST_MOVE":this.emit({type:"bestMove",move:t.move,ponder:t.ponder});break;case"ERROR":this.emit({type:"error",error:t.error});break}}analyzePosition(t){!this.isInitialized||!this.stockfishWorker||this.stockfishWorker.postMessage({type:"ANALYZE_POSITION",payload:{fen:t}})}findBestMove(t){!this.isInitialized||!this.stockfishWorker||this.stockfishWorker.postMessage({type:"FIND_BEST_MOVE",payload:{fen:t,timeLimit:this.config.timeLimit}})}stop(){this.stockfishWorker&&this.stockfishWorker.postMessage({type:"STOP"})}updateConfig(t){this.config={...this.config,...t},this.stockfishWorker&&this.stockfishWorker.postMessage({type:"UPDATE_CONFIG",payload:t})}onEvent(t){return this.eventHandlers.push(t),()=>{const n=this.eventHandlers.indexOf(t);n>=0&&this.eventHandlers.splice(n,1)}}emit(t){this.eventHandlers.forEach(n=>{try{n(t)}catch(r){console.error("Engine event handler error:",r)}})}dispose(){this.stockfishWorker&&(this.stockfishWorker.terminate(),this.stockfishWorker=null),this.eventHandlers=[],this.isInitialized=!1}}const Zt="/ban-chess-gui/",Ne=["a","b","c","d","e","f","g","h"];function Ae(e,t=100){try{const n=new(window.AudioContext||window.webkitAudioContext),r=n.createOscillator(),i=n.createGain();r.connect(i),i.connect(n.destination),r.frequency.value=e,r.type="sine",i.gain.setValueAtTime(.3,n.currentTime),i.gain.exponentialRampToValueAtTime(.01,n.currentTime+t/1e3),r.start(n.currentTime),r.stop(n.currentTime+t/1e3)}catch{}}function Xt(){const[e]=Z(()=>new ue),[t,n]=Z([]),[r,i]=Z(null),[s,p]=Z([]),[u,o]=Z([]),[l,v]=Z(null),[a,S]=Z(!1),[d,E]=Z([]),[O,K]=Z(-1),[N,B]=Z(0),[x,Q]=Z(!1),[,re]=Z({}),[X]=Z(()=>new Yt({multiPV:3,depth:18,timeLimit:3e3})),[J]=Z({});Re(()=>{k(),X.initialize().catch(console.error);const h=X.onEvent(g=>{g.type==="evaluation"?(B(g.evaluation.score),Q(!1)):g.type==="bestMove"?Q(!1):g.type==="ready"&&(console.log("Stockfish engine is ready"),e.fen()&&X.analyzePosition(e.fen()))});return()=>{h(),X.dispose()}},[]),Re(()=>{const h=e.fen();h&&(Q(!0),X.analyzePosition(h))},[d,O]);const te=h=>{if(!h)return null;const g=h;if(J[g])return J[g];const C=h===h.toUpperCase(),M=h.toUpperCase(),$={K:"King",Q:"Queen",R:"Rook",B:"Bishop",N:"Knight",P:"Pawn"}[M];if(!$)return null;const L=`${Zt}pieces/classic/${C?"white":"black"}/${$}.png`;return J[g]=L,L},k=()=>{const C=e.fen().split(" ")[0].split("/").map(M=>{const F=[];for(const $ of M)if(isNaN(parseInt($)))F.push($);else for(let L=0;L<parseInt($);L++)F.push(null);return F});n(C),p(e.legalMoves()),o(e.legalBans())},w=(h,g)=>{if(a){const C=h+1;return Ne[7-g]+C}else{const C=8-h;return Ne[g]+C}},R=h=>r?e.nextActionType()==="move"?s.some(g=>g.from===r&&g.to===h):u.some(g=>g.from===r&&g.to===h):!1,c=h=>e.nextActionType()==="move"?s.some(g=>g.from===h):u.some(g=>g.from===h),f=(h,g)=>{const C=w(h,g);if(Ae(600,50),!r){c(C)&&i(C);return}if(C===r){i(null);return}if(R(C)){const M=e.nextActionType()==="move"?{move:{from:r,to:C}}:{ban:{from:r,to:C}};_(M)}else c(C)&&i(C)},_=h=>{if(e.play(h).success){e.nextActionType()==="ban"?Ae(800,150):Ae(400,200);const C="move"in h?h.move.from:h.ban.from,M="move"in h?h.move.to:h.ban.to;E(F=>[...F,h]),K(d.length),v({from:C,to:M}),k(),i(null),re({}),e.gameOver()&&setTimeout(()=>{Ae(200,500)},200)}},m=(h,g)=>a?t[7-h]?.[7-g]:t[h]?.[g],y=h=>{const g=te(h);return g?b("img",{src:g,alt:h,style:{width:"90%",height:"90%",objectFit:"contain",userSelect:"none",pointerEvents:"none"}}):null},P=h=>{e.reset();for(let g=0;g<=h;g++)d[g]&&e.play(d[g]);K(h),k(),re({})},A=h=>{B(h.evaluation.score)},T=()=>{Ae(1e3,100),e.reset(),E([]),K(-1),v(null),i(null),B(0),k(),re({})};return b("div",{className:"lichess-analysis-layout",children:[b("div",{className:"lichess-left-sidebar",children:b("div",{className:"lichess-eval-bar",children:[b("div",{className:"lichess-eval-bar-fill",style:{height:`${Math.max(0,Math.min(100,50+N/100*25))}%`,bottom:0}}),b("div",{className:`lichess-eval-score ${Math.abs(N)>200?N>0?"white-winning":"black-winning":""}`,children:Math.abs(N)>=2e3?N>0?"+M":"-M":N>=0?`+${(N/100).toFixed(1)}`:(N/100).toFixed(1)}),x&&b("div",{style:{position:"absolute",top:"4px",left:"50%",transform:"translateX(-50%)",width:"12px",height:"12px",border:"2px solid var(--lichess-border)",borderTop:"2px solid var(--lichess-primary)",borderRadius:"50%",animation:"lichess-spin 1s linear infinite"}})]})}),b("div",{className:"lichess-board-area",children:[b("div",{className:"lichess-board-wrapper",children:[b("div",{className:"lichess-board",children:[0,1,2,3,4,5,6,7].map(h=>[0,1,2,3,4,5,6,7].map(g=>{const C=w(h,g),M=m(h,g),F=C===r,$=r&&R(C),L=(h+g)%2===0,U=l&&(l.from===C||l.to===C),ee=e.currentBannedMove&&(e.currentBannedMove.from===C||e.currentBannedMove.to===C);return b("div",{onClick:()=>f(h,g),className:`lichess-square ${L?"light":"dark"} ${F?"selected":""} ${$?"legal-move":""} ${$&&M?"has-piece":""} ${U?"last-move":""}`,children:[M&&y(M),ee&&b("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",color:"#dc2626",fontSize:"24px",fontWeight:"bold",textShadow:"2px 2px 4px rgba(0,0,0,0.5)",pointerEvents:"none"},children:"×"})]},`${h}-${g}`)}))}),b("div",{style:{position:"absolute",left:"-20px",top:"0",height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-around",fontSize:"12px",color:"var(--lichess-text-secondary)"},children:Array.from({length:8},(h,g)=>b("div",{children:a?g+1:8-g},g))}),b("div",{style:{position:"absolute",bottom:"-20px",left:"0",right:"0",display:"flex",justifyContent:"space-around",fontSize:"12px",color:"var(--lichess-text-secondary)"},children:Array.from({length:8},(h,g)=>b("div",{children:a?Ne[7-g]:Ne[g]},g))})]}),b("div",{style:{marginTop:"24px",textAlign:"center"},children:[b("div",{style:{fontSize:"16px",marginBottom:"16px",color:"var(--lichess-text)"},children:e.gameOver()?b("div",{style:{color:"#ffeb3b",fontWeight:"600"},children:e.inCheckmate()?`Checkmate! ${e.turn==="white"?"Black":"White"} wins!`:"Draw!"}):b("div",{children:[b("span",{style:{color:e.turn==="white"?"#fff":"#aaa"},children:e.turn==="white"?"White":"Black"}),b("span",{style:{margin:"0 8px"},children:"to"}),b("span",{style:{color:e.nextActionType()==="ban"?"#e57373":"var(--lichess-accent)",fontWeight:"500"},children:e.nextActionType()==="ban"?"ban":"move"})]})}),b("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[b("button",{onClick:T,style:{padding:"10px 20px",background:"var(--lichess-primary)",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"New Game"}),b("button",{onClick:()=>S(!a),style:{padding:"10px 20px",background:"var(--lichess-panel-bg)",color:"var(--lichess-text)",border:"1px solid var(--lichess-border)",borderRadius:"4px",cursor:"pointer",fontSize:"14px"},children:"Flip Board"})]})]})]}),b(Vt,{fen:e.fen(),moveHistory:d,currentMoveIndex:O,engineManager:X,onMoveSelect:P,onLineSelect:A})]})}function Jt(){return b(Xt,{})}Ft(b(Jt,{}),document.getElementById("app"));
